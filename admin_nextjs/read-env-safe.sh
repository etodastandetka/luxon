#!/bin/bash
# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞ (—Å–∫—Ä—ã–≤–∞–µ—Ç –ø–∞—Ä–æ–ª–∏)

echo "üìÑ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .env —Ñ–∞–π–ª–∞ (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º):"
echo ""

if [ -f ".env" ]; then
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏, –Ω–æ –º–∞—Å–∫–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –∏ —Ç–æ–∫–µ–Ω–æ–≤
    while IFS= read -r line; do
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
        if [[ "$line" =~ ^[[:space:]]*# ]] || [[ -z "${line// }" ]]; then
            echo "$line"
            continue
        fi
        
        # –ú–∞—Å–∫–∏—Ä—É–µ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        if [[ "$line" =~ (PASSWORD|SECRET|TOKEN|KEY|PASS)= ]]; then
            key=$(echo "$line" | cut -d'=' -f1)
            value=$(echo "$line" | cut -d'=' -f2-)
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 4 —Å–∏–º–≤–æ–ª–∞ –∑–Ω–∞—á–µ–Ω–∏—è
            if [ ${#value} -gt 4 ]; then
                masked="${value:0:4}****"
                echo "${key}=${masked}"
            else
                echo "${key}=****"
            fi
        else
            echo "$line"
        fi
    done < .env
else
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
fi

