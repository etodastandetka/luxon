# üó∫Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω–æ–π –∑–∞—â–∏—Ç—ã

## –û–ø–∏—Å–∞–Ω–∏–µ

–ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–π –∑–æ–Ω–µ (10 –º–µ—Ç—Ä–æ–≤ –æ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç) –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–∞–π—Ç—É.

## –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

- **–®–∏—Ä–æ—Ç–∞**: 42.84877 (—Å.—à.)
- **–î–æ–ª–≥–æ—Ç–∞**: 74.57028 (–≤.–¥.)
- **–†–∞–¥–∏—É—Å**: 10 –º–µ—Ç—Ä–æ–≤

–≠—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ë–∏—à–∫–µ–∫–∞, –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
ALLOWED_LATITUDE=42.84877
ALLOWED_LONGITUDE=74.57028
ALLOWED_RADIUS_METERS=10
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API endpoint –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
curl -X GET https://japar.click/api/geolocation/settings \
  -H "Cookie: auth_token=YOUR_TOKEN"

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
curl -X POST https://japar.click/api/geolocation/settings \
  -H "Cookie: auth_token=YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "latitude": 42.84877,
    "longitude": 74.57028,
    "radius": 10
  }'
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç** ‚Üí Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cookie `geolocation_verified`
2. **–ï—Å–ª–∏ cookie –Ω–µ—Ç** ‚Üí –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/geolocation`
3. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏** ‚Üí –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
4. **–ü–æ–ª—É—á–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã** ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ `/api/geolocation/verify`
5. **–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** ‚Üí –í—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–π –∑–æ–Ω—ã
6. **–ï—Å–ª–∏ –≤ –∑–æ–Ω–µ** ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
7. **–ï—Å–ª–∏ –Ω–µ –≤ –∑–æ–Ω–µ** ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ"

## –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞ –≥–∞–≤–µ—Ä—Å–∏–Ω—É—Å–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –Ω–∞ –ó–µ–º–ª–µ:

```
distance = 2 * R * atan2(‚àöa, ‚àö(1-a))

–≥–¥–µ:
a = sin¬≤(Œîlat/2) + cos(lat1) * cos(lat2) * sin¬≤(Œîlon/2)
R = 6371000 –º–µ—Ç—Ä–æ–≤ (—Ä–∞–¥–∏—É—Å –ó–µ–º–ª–∏)
```

## API Endpoints

### POST /api/geolocation/verify
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "latitude": 42.84877,
  "longitude": 74.57028
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "success": true,
  "data": {
    "success": true,
    "message": "Location verified",
    "distance": "within allowed zone"
  }
}
```

**–û—Ç–≤–µ—Ç (–Ω–µ –≤ –∑–æ–Ω–µ):**
```json
{
  "success": false,
  "error": "–°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ"
}
```

### GET /api/geolocation/settings
–ü–æ–ª—É—á–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

### POST /api/geolocation/settings
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "latitude": 42.84877,
  "longitude": 74.57028,
  "radius": 10
}
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ Cookie —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ Cookie httpOnly (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ JavaScript)
- ‚úÖ Cookie –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 24 —á–∞—Å–∞
- ‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Rate limiting (10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É)

## –ò—Å–∫–ª—é—á–µ–Ω–∏—è

–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–ª—è:
- API endpoints (–∫—Ä–æ–º–µ `/api/geolocation/verify`)
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (`/_next/`, `/favicon.ico`)
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (`/geolocation`)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–¥–∏—É—Å–∞

–†–∞–¥–∏—É—Å –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç 1 –¥–æ 10000 –º–µ—Ç—Ä–æ–≤:
- **1-10 –º–µ—Ç—Ä–æ–≤**: –û—á–µ–Ω—å —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–¥–∞–Ω–∏–µ)
- **10-100 –º–µ—Ç—Ä–æ–≤**: –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–ª–µ–≥–∞—é—â–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è)
- **100-1000 –º–µ—Ç—Ä–æ–≤**: –£–º–µ—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ä–∞–π–æ–Ω)
- **1000-10000 –º–µ—Ç—Ä–æ–≤**: –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–≥–æ—Ä–æ–¥/—Ä–µ–≥–∏–æ–Ω)

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/geolocation`:
```javascript
navigator.geolocation.getCurrentPosition((pos) => {
  console.log('Latitude:', pos.coords.latitude)
  console.log('Longitude:', pos.coords.longitude)
})
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

```bash
curl https://japar.click/api/geolocation/settings \
  -H "Cookie: auth_token=YOUR_TOKEN"
```

## –í–∞–∂–Ω–æ

‚ö†Ô∏è **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ HTTPS** –∏–ª–∏ –Ω–∞ localhost. –í HTTP –±—Ä–∞—É–∑–µ—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.

‚ö†Ô∏è **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø** –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

‚ö†Ô∏è **–¢–æ—á–Ω–æ—Å—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏** –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å ¬±5-50 –º–µ—Ç—Ä–æ–≤.

## –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

–ß—Ç–æ–±—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏, –º–æ–∂–Ω–æ:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π —Ä–∞–¥–∏—É—Å (10000 –º–µ—Ç—Ä–æ–≤)
2. –ò–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ middleware

–ù–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

