# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MobCash API —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º OAuth2

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–í–∞—Ä–∏–∞–Ω—Ç 2)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –≤ `.env`:

```env
# MobCash API - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π OAuth2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
MOBCASH_LOGIN="burgoevk"
MOBCASH_PASSWORD="Kanat312###"
MOBCASH_CASHDESK_ID="1001098"
MOBCASH_DEFAULT_LAT=42.845778
MOBCASH_DEFAULT_LON=74.568778

# –°—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã –º–æ–∂–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å
# MOBCASH_BEARER_TOKEN="..."
# MOBCASH_USER_ID="..."
# MOBCASH_SESSION_ID="..."
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π OAuth2 flow:
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `LoginChallenge`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `ConsentChallenge` (—Å –ª–æ–≥–∏–Ω–æ–º/–ø–∞—Ä–æ–ª–µ–º)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `Access Token`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `UserID`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `SessionID`

2. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 1 —á–∞—Å –≤ –ø–∞–º—è—Ç–∏

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω—ã –∏—Å—Ç–µ–∫–ª–∏ (401 –æ—à–∏–±–∫–∞):
   - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç –∫–µ—à
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–æ–≤—ã–π OAuth2 flow
   - –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤**  
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç 24/7 –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞**  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏**  
‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `.env`, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:

```bash
pm2 restart luxon-email-watcher
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
pm2 logs luxon-email-watcher --lines 50
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
[MobCash Auth] üîÑ Starting OAuth2 flow with login: burgoevk
[MobCash Auth] –®–∞–≥ 1.1: –ü–æ–ª—É—á–µ–Ω–∏–µ LoginChallenge...
[MobCash Auth] ‚úÖ LoginChallenge –ø–æ–ª—É—á–µ–Ω
[MobCash Auth] –®–∞–≥ 1.2: –ü–æ–ª—É—á–µ–Ω–∏–µ ConsentChallenge...
[MobCash Auth] ‚úÖ ConsentChallenge –ø–æ–ª—É—á–µ–Ω
[MobCash Auth] –®–∞–≥ 1.3: –ü–æ–ª—É—á–µ–Ω–∏–µ Access Token...
[MobCash Auth] ‚úÖ Access token –ø–æ–ª—É—á–µ–Ω
[MobCash Auth] –®–∞–≥ 1.4: –ü–æ–ª—É—á–µ–Ω–∏–µ UserID...
[MobCash Auth] User ID extracted: ...
[MobCash Auth] –®–∞–≥ 1.5: –õ–æ–≥–∏–Ω –Ω–∞ –∫–∞—Å—Å—É...
[MobCash Auth] SessionID extracted: ...
[MobCash Auth] ‚úÖ OAuth2 flow completed successfully
```

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å** - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –∫–∞—Å—Å—ã** - `MOBCASH_CASHDESK_ID` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã** - `MOBCASH_DEFAULT_LAT` –∏ `MOBCASH_DEFAULT_LON` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º–∏
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** - —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ `admin.mob-cash.com`

## –ì–∏–±—Ä–∏–¥–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã, –Ω–æ –∏–º–µ—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏:

```env
# –ì–æ—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å)
MOBCASH_BEARER_TOKEN="ory_at_..."
MOBCASH_USER_ID="..."
MOBCASH_SESSION_ID="..."

# –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (fallback)
MOBCASH_LOGIN="burgoevk"
MOBCASH_PASSWORD="Kanat312###"
MOBCASH_CASHDESK_ID="1001098"
MOBCASH_DEFAULT_LAT=42.845778
MOBCASH_DEFAULT_LON=74.568778
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ:
- –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≥–æ—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã (–±—ã—Å—Ç—Ä–µ–µ)
- –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è OAuth2 flow
- –ù–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–ª—å—à–µ

