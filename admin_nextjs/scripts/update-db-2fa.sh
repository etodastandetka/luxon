#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ 2FA

set -e

echo "üóÑÔ∏è  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è 2FA"
echo ""

cd /var/www/luxon/admin_nextjs || exit 1

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env
if [ ! -f .env ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

echo "üìã –ü—Ä–∏–º–µ–Ω—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã Prisma –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö..."
echo ""

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –∫ –ë–î
npm run db:push

if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞!"
    echo ""
    echo "üì¶ –ì–µ–Ω–µ—Ä–∏—Ä—É—é Prisma Client..."
    npm run db:generate
    
    if [ $? -eq 0 ]; then
        echo ""
        echo "‚úÖ Prisma Client –æ–±–Ω–æ–≤–ª–µ–Ω!"
        echo ""
        echo "üéâ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 2FA:"
        echo "   ./scripts/setup-2fa-for-admins.sh"
    else
        echo ""
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Prisma Client"
        exit 1
    fi
else
    echo ""
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –ë–î"
    exit 1
fi

