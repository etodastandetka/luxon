#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ .env

set -e

echo "üîß –í–∫–ª—é—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏..."
echo ""

cd /var/www/luxon/admin_nextjs || exit 1

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ .env —Ñ–∞–π–ª
if [ ! -f .env ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–∏ —É–∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
if grep -q "^GEOLOCATION_ENABLED=" .env; then
    echo "üìù –û–±–Ω–æ–≤–ª—è—é —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é GEOLOCATION_ENABLED..."
    # –ó–∞–º–µ–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ true
    sed -i 's/^GEOLOCATION_ENABLED=.*/GEOLOCATION_ENABLED=true/' .env
else
    echo "‚ûï –î–æ–±–∞–≤–ª—è—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é GEOLOCATION_ENABLED=true..."
    echo "" >> .env
    echo "# –í–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏" >> .env
    echo "GEOLOCATION_ENABLED=true" >> .env
fi

echo ""
echo "‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –≤ .env"
echo ""
echo "üìã –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:"
grep "^GEOLOCATION_ENABLED=" .env || echo "  (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)"
echo ""
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
pm2 restart luxon-admin

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ."
echo ""

