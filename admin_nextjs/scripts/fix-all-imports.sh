#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–º–µ–Ω—ã –≤—Å–µ—Ö –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π –∫ lib/ –Ω–∞ –∞–ª–∏–∞—Å—ã @/lib/

set -e

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ lib/ –Ω–∞ –∞–ª–∏–∞—Å—ã @/lib/..."
echo ""

cd /var/www/luxon/admin_nextjs || exit 1

# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ –∫ lib/
find app -type f \( -name "*.ts" -o -name "*.tsx" \) -exec grep -l "from ['\"]\.\.\/.*lib\/" {} \; | while read file; do
    echo "  üìù –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é: $file"
    
    # –ó–∞–º–µ–Ω—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π
    # ../../lib/ -> @/lib/
    sed -i "s|from ['\"]\.\.\/\.\.\/lib\/|from '@/lib/|g" "$file"
    
    # ../../../lib/ -> @/lib/
    sed -i "s|from ['\"]\.\.\/\.\.\/\.\.\/lib\/|from '@/lib/|g" "$file"
    
    # ../../../../lib/ -> @/lib/
    sed -i "s|from ['\"]\.\.\/\.\.\/\.\.\/\.\.\/lib\/|from '@/lib/|g" "$file"
    
    # ../../../../../lib/ -> @/lib/
    sed -i "s|from ['\"]\.\.\/\.\.\/\.\.\/\.\.\/\.\.\/lib\/|from '@/lib/|g" "$file"
    
    # ../../../../../../lib/ -> @/lib/
    sed -i "s|from ['\"]\.\.\/\.\.\/\.\.\/\.\.\/\.\.\/\.\.\/lib\/|from '@/lib/|g" "$file"
done

echo ""
echo "‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!"
echo ""
echo "üìã –ü—Ä–æ–≤–µ—Ä—è—é –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏..."
remaining=$(find app -type f \( -name "*.ts" -o -name "*.tsx" \) -exec grep -l "from ['\"]\.\.\/.*lib\/" {} \; | wc -l)
if [ "$remaining" -gt 0 ]; then
    echo "‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω–æ –µ—â–µ $remaining —Ñ–∞–π–ª–æ–≤ —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏:"
    find app -type f \( -name "*.ts" -o -name "*.tsx" \) -exec grep -l "from ['\"]\.\.\/.*lib\/" {} \;
else
    echo "‚úÖ –í—Å–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∑–∞–º–µ–Ω–µ–Ω—ã!"
fi

