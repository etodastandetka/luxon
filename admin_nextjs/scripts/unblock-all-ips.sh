#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—Å–µ—Ö IP (–æ—á–∏—Å—Ç–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏–∑ –ø–∞–º—è—Ç–∏ –∏ –ë–î)

echo "üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö IP –∞–¥—Ä–µ—Å–æ–≤"
echo ""

cd /var/www/luxon/admin_nextjs || exit 1

echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –æ—á–∏—Å—Ç–∏—Ç –í–°–ï –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP!"
echo "   –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ, –µ—Å–ª–∏ —É –≤–∞—Å –±—ã–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∞—Ç–∞–∫–∏."
echo ""
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (yes/no): " confirm

if [ "$confirm" != "yes" ]; then
    echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
    exit 0
fi

echo ""
echo "1Ô∏è‚É£ –û—á–∏—â–∞—é –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–∑ –ë–î..."
if [ -f "scripts/unblock-all-ips.ts" ]; then
    npx tsx scripts/unblock-all-ips.ts
    if [ $? -eq 0 ]; then
        echo "  ‚úÖ –ë–î –æ—á–∏—â–µ–Ω–∞"
    else
        echo "  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ë–î (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π)"
    fi
else
    echo "  ‚ö†Ô∏è  –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞—é"
fi

echo ""
echo "2Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –ø–∞–º—è—Ç–∏..."
pm2 restart luxon-admin

if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –í—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—á–∏—â–µ–Ω—ã:"
    echo "   ‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –ø–∞–º—è—Ç–∏ (–æ—á–∏—â–µ–Ω—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º)"
    echo "   ‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –ë–î (–æ—á–∏—â–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º)"
    echo ""
    echo "üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: pm2 logs luxon-admin --lines 20"
else
    echo ""
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    exit 1
fi
echo ""

