# Исправление проблем с базой данных

## Проблемы:
1. `DATABASE_URL` не загружается в PM2
2. Колонка `chat_messages.reply_to_id` отсутствует в базе данных

## Решение:

### 1. Исправление PM2 конфигурации
Конфигурация PM2 обновлена для загрузки переменных окружения из `.env` файла.

### 2. Применение миграции базы данных

Выполните на сервере:

```bash
cd /var/www/luxon/admin_nextjs

# Применяем схему к базе данных (добавит недостающие колонки)
npm run db:push

# Или создаем и применяем миграцию
npx prisma migrate dev --name add_reply_to_id

# Генерируем Prisma Client
npm run db:generate

# Перезапускаем PM2
pm2 restart luxon-admin
```

### 3. Проверка

После применения миграции проверьте, что колонка добавлена:

```bash
# Подключитесь к базе данных и проверьте
psql $DATABASE_URL -c "\d chat_messages"
```

Колонка `reply_to_id` должна присутствовать в таблице `chat_messages`.

