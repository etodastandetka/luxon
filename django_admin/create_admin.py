#!/usr/bin/env python
import os
import sys
import django

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'admin_panel.settings')
django.setup()

from django.contrib.auth.models import User
from bot_control.models import UserProfile

def create_admin():
    """–°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
    print("=== –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ===")
    
    # –î–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∞
    username = 'admin'
    email = 'admin@luxon.com'
    password = 'admin123'
    
    try:
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–≥–æ –∞–¥–º–∏–Ω–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
        if User.objects.filter(username=username).exists():
            User.objects.filter(username=username).delete()
            print(f"‚úÖ –°—Ç–∞—Ä—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {username} —É–¥–∞–ª–µ–Ω")
        
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        admin_user = User.objects.create_superuser(
            username=username,
            email=email,
            password=password
        )
        print(f"‚úÖ –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {username} —Å–æ–∑–¥–∞–Ω")
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∞
        profile, created = UserProfile.objects.get_or_create(
            user=admin_user,
            defaults={
                'is_2fa_enabled': False,
                'secret_key': ''
            }
        )
        
        if created:
            print(f"‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –¥–ª—è {username} —Å–æ–∑–¥–∞–Ω")
        else:
            print(f"‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –¥–ª—è {username} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ
        print(f"\nüìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:")
        print(f"Username: {username}")
        print(f"Email: {email}")
        print(f"Password: {password}")
        print(f"2FA: {'–í–∫–ª—é—á–µ–Ω–∞' if profile.is_2fa_enabled else '–û—Ç–∫–ª—é—á–µ–Ω–∞'}")
        
        print(f"\n‚úÖ –ê–¥–º–∏–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞: {e}")

if __name__ == "__main__":
    create_admin()
