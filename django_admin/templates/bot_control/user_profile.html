{% extends 'base.html' %}
{% load static %}

{% block title %}Профиль {{ user.username|default:user.user_id }}{% endblock %}

{% block content %}
<style>
  .card { border-radius: 14px !important; border: 1px solid #242424 !important; background: #111 !important; }
  .kpi { display:grid; grid-template-columns: repeat(2,1fr); gap:10px; }
  .kpi .item { background:#0f0f0f; border:1px solid #222; border-radius:10px; padding:12px; }
  .kpi .label { color:#9aa4b2; font-size:12px; }
  .kpi .value { color:#e8f0ff; font-size:18px; font-weight:700; }
  .req-row { display:flex; align-items:center; justify-content:space-between; padding:10px 2px; border-bottom:1px solid #1a1a1a; color:#cdd6f4; text-decoration:none; }
  .req-row:hover { background:#0f0f0f; }
</style>

<div class="page-header" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
  <div style="display:flex; align-items:center; gap:12px;">
    <div class="header-avatar"><i class="fas fa-user"></i></div>
    <div class="header-content">
      <h1>Профиль {{ user.username|default:user.user_id }}</h1>
      <p>ID: {{ user.user_id }}</p>
    </div>
  </div>
  {% if user.username %}
    <a class="action-btn action-btn--neutral" href="https://t.me/{{ user.username }}" target="_blank">Открыть в Telegram</a>
  {% else %}
    <a class="action-btn action-btn--neutral" href="tg://user?id={{ user.user_id }}">Открыть в Telegram</a>
  {% endif %}
</div>

<div class="card" style="padding:16px;">
  <div class="kpi">
    <div class="item"><div class="label">Всего пополнено</div><div class="value">{{ stats.total_deposits|floatformat:2 }} сом</div></div>
    <div class="item"><div class="label">Всего выведено</div><div class="value">{{ stats.total_withdrawals|floatformat:2 }} сом</div></div>
    <div class="item"><div class="label">Кол-во пополнений</div><div class="value">{{ stats.deposit_count }}</div></div>
    <div class="item"><div class="label">Кол-во выводов</div><div class="value">{{ stats.withdraw_count }}</div></div>
    <div class="item" style="grid-column:1 / -1;"><div class="label">Чистый итог</div><div class="value" style="color:{% if stats.net >= 0 %}#21f39c{% else %}#ff6b6b{% endif %};">{{ stats.net|floatformat:2 }} сом</div></div>
  </div>
</div>

{% if requests %}
<div class="card" style="padding:12px; margin-top:12px;">
  <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
    <i class="fas fa-list"></i>
    <div style="font-weight:600;">Все заявки</div>
  </div>
  <div style="border-top:1px solid #222"></div>
  {% for r in requests %}
    <a href="{% url 'bot_control:transaction_detail' r.id %}" class="req-row">
      <div style="display:flex; align-items:center; gap:10px; min-width:0;">
        <div style="color:#8b8b8b; font-size:12px;">#{{ r.id }}</div>
        <div style="color:#9aa4b2; font-size:11px; white-space:nowrap;">{{ r.created_at|slice:":16" }}</div>
        <div style="font-size:12px; color:#7a869a;">{{ r.bookmaker|upper }}</div>
      </div>
      <div style="display:flex; align-items:center; gap:12px;">
        <div style="font-weight:600; font-size:13px; {% if r.type == 'deposit' %}color:#21f39c;{% else %}color:#ff6b6b;{% endif %}">{{ r.amount|floatformat:2 }} сом</div>
        <div style="font-size:11px; padding:2px 6px; border-radius:6px; border:1px solid #2a2a2a; color:#aab1c2; background:#151515;">
          {% if r.status == 'pending' %}Ожидает{% elif r.status == 'processing' %}В обработке{% elif r.status == 'completed' %}Завершена{% elif r.status == 'rejected' %}Отклонена{% elif r.status == 'awaiting_manual' %}Оставленные{% else %}{{ r.status }}{% endif %}
        </div>
        <i class="fas fa-chevron-right" style="color:#555;"></i>
      </div>
    </a>
  {% endfor %}
</div>
{% endif %}

{% endblock %}
