{% extends 'base.html' %}

{% block title %}API Букмекеров - Админ Панель{% endblock %}

{% block header_icon %}plug{% endblock %}
{% block header_title %}API Букмекеров{% endblock %}
{% block header_subtitle %}Управление всеми API{% endblock %}

{% block content %}
<!-- Выбор букмекера -->
<div class="card">
    <div class="card-header">
        <div class="card-icon">
            <i class="fas fa-list"></i>
        </div>
        <div>
            <div class="card-title">Выберите букмекера</div>
            <div class="card-subtitle">Выберите API для работы</div>
        </div>
    </div>
    
    <div class="bookmaker-tabs">
        <button class="tab-btn active" data-tab="1xbet">
            <i class="fas fa-coins"></i>
            <span>1XBET</span>
        </button>
        <button class="tab-btn" data-tab="1win">
            <i class="fas fa-trophy"></i>
            <span>1WIN</span>
        </button>
        <button class="tab-btn" data-tab="melbet">
            <i class="fas fa-dice"></i>
            <span>MELBET</span>
        </button>
        <button class="tab-btn" data-tab="mostbet">
            <i class="fas fa-star"></i>
            <span>MOSTBET</span>
        </button>
    </div>
</div>

<!-- 1XBET API -->
<div id="1xbet" class="bookmaker-content active">
    <div class="card">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-coins"></i>
            </div>
            <div>
                <div class="card-title">1XBET API</div>
                <div class="card-subtitle">MobCash интеграция</div>
            </div>
        </div>
        
        <!-- Баланс -->
        <div class="api-section">
            <h4><i class="fas fa-wallet"></i> Баланс кассы</h4>
            <button id="1xbet-balance" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-sync"></i> Проверить баланс
            </button>
            <div id="1xbet-balance-result" class="api-result"></div>
        </div>
        
        <!-- Поиск игрока -->
        <div class="api-section">
            <h4><i class="fas fa-search"></i> Поиск игрока</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="1xbet-search-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <button id="1xbet-search" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-search"></i> Найти игрока
            </button>
            <div id="1xbet-search-result" class="api-result"></div>
        </div>
        
        <!-- Пополнение -->
        <div class="api-section">
            <h4><i class="fas fa-plus"></i> Пополнение счета</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="1xbet-deposit-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <div class="form-group">
                <label class="form-label">Сумма</label>
                <input type="number" id="1xbet-deposit-amount" class="form-control" placeholder="Введите сумму" min="1" step="0.01">
            </div>
            <button id="1xbet-deposit" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-plus"></i> Пополнить счет
            </button>
            <div id="1xbet-deposit-result" class="api-result"></div>
        </div>
    </div>
</div>

<!-- 1WIN API -->
<div id="1win" class="bookmaker-content">
    <div class="card">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <div>
                <div class="card-title">1WIN API</div>
                <div class="card-subtitle">TeamCash интеграция</div>
            </div>
        </div>
        
        <!-- Пополнение -->
        <div class="api-section">
            <h4><i class="fas fa-plus"></i> Пополнение счета</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="1win-deposit-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <div class="form-group">
                <label class="form-label">Сумма</label>
                <input type="number" id="1win-deposit-amount" class="form-control" placeholder="Введите сумму" min="1" step="0.01">
            </div>
            <button id="1win-deposit" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-plus"></i> Пополнить счет
            </button>
            <div id="1win-deposit-result" class="api-result"></div>
        </div>
        
        <!-- Вывод -->
        <div class="api-section">
            <h4><i class="fas fa-minus"></i> Вывод средств</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="1win-withdraw-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <div class="form-group">
                <label class="form-label">Сумма</label>
                <input type="number" id="1win-withdraw-amount" class="form-control" placeholder="Введите сумму" min="1" step="0.01">
            </div>
            <button id="1win-withdraw" class="btn btn-danger" style="width: 100%;">
                <i class="fas fa-minus"></i> Вывести средства
            </button>
            <div id="1win-withdraw-result" class="api-result"></div>
        </div>
    </div>
</div>

<!-- MELBET API -->
<div id="melbet" class="bookmaker-content">
    <div class="card">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-dice"></i>
            </div>
            <div>
                <div class="card-title">MELBET API</div>
                <div class="card-subtitle">TeamCash интеграция</div>
            </div>
        </div>
        
        <!-- Баланс -->
        <div class="api-section">
            <h4><i class="fas fa-wallet"></i> Баланс кассы</h4>
            <button id="melbet-balance" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-sync"></i> Проверить баланс
            </button>
            <div id="melbet-balance-result" class="api-result"></div>
        </div>
        
        <!-- Поиск игрока -->
        <div class="api-section">
            <h4><i class="fas fa-search"></i> Поиск игрока</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="melbet-search-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <button id="melbet-search" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-search"></i> Найти игрока
            </button>
            <div id="melbet-search-result" class="api-result"></div>
        </div>
        
        <!-- Пополнение -->
        <div class="api-section">
            <h4><i class="fas fa-plus"></i> Пополнение счета</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="melbet-deposit-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <div class="form-group">
                <label class="form-label">Сумма</label>
                <input type="number" id="melbet-deposit-amount" class="form-control" placeholder="Введите сумму" min="1" step="0.01">
            </div>
            <button id="melbet-deposit" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-plus"></i> Пополнить счет
            </button>
            <div id="melbet-deposit-result" class="api-result"></div>
        </div>
    </div>
</div>

<!-- MOSTBET API -->
<div id="mostbet" class="bookmaker-content">
    <div class="card">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-star"></i>
            </div>
            <div>
                <div class="card-title">MOSTBET API</div>
                <div class="card-subtitle">Mostbet Cash интеграция</div>
            </div>
        </div>
        
        <!-- Баланс -->
        <div class="api-section">
            <h4><i class="fas fa-wallet"></i> Баланс кассы</h4>
            <button id="mostbet-balance" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-sync"></i> Проверить баланс
            </button>
            <div id="mostbet-balance-result" class="api-result"></div>
        </div>
        
        <!-- Поиск игрока -->
        <div class="api-section">
            <h4><i class="fas fa-search"></i> Поиск игрока</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="mostbet-search-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <button id="mostbet-search" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-search"></i> Найти игрока
            </button>
            <div id="mostbet-search-result" class="api-result"></div>
        </div>
        
        <!-- Пополнение -->
        <div class="api-section">
            <h4><i class="fas fa-plus"></i> Пополнение счета</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="mostbet-deposit-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <div class="form-group">
                <label class="form-label">Сумма</label>
                <input type="number" id="mostbet-deposit-amount" class="form-control" placeholder="Введите сумму" min="1" step="0.01">
            </div>
            <button id="mostbet-deposit" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-plus"></i> Пополнить счет
            </button>
            <div id="mostbet-deposit-result" class="api-result"></div>
        </div>
        
        <!-- Вывод -->
        <div class="api-section">
            <h4><i class="fas fa-minus"></i> Вывод средств</h4>
            <div class="form-group">
                <label class="form-label">ID игрока</label>
                <input type="text" id="mostbet-withdraw-id" class="form-control" placeholder="Введите ID игрока">
            </div>
            <div class="form-group">
                <label class="form-label">Сумма</label>
                <input type="number" id="mostbet-withdraw-amount" class="form-control" placeholder="Введите сумму" min="1" step="0.01">
            </div>
            <button id="mostbet-withdraw" class="btn btn-danger" style="width: 100%;">
                <i class="fas fa-minus"></i> Вывести средства
            </button>
            <div id="mostbet-withdraw-result" class="api-result"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<style>
    .bookmaker-tabs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 15px;
    }
    
    .tab-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px 10px;
        background: #333333;
        border: 2px solid #444444;
        border-radius: 10px;
        color: #cccccc;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    
    .tab-btn:hover {
        background: #444444;
        border-color: #555555;
    }
    
    .tab-btn.active {
        background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
        border-color: #00ff88;
        color: #000000;
    }
    
    .tab-btn i {
        font-size: 20px;
        margin-bottom: 5px;
    }
    
    .tab-btn span {
        font-size: 12px;
        font-weight: 600;
    }
    
    .bookmaker-content {
        display: none;
    }
    
    .bookmaker-content.active {
        display: block;
    }
    
    .api-section {
        background: #333333;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 15px;
        border: 1px solid #444444;
    }
    
    .api-section h4 {
        color: #ffffff;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .api-section h4 i {
        color: #00ff88;
    }
    
    .api-result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 8px;
        font-size: 14px;
        display: none;
    }
    
    .api-result.success {
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid #00ff88;
        color: #00ff88;
        display: block;
    }
    
    .api-result.error {
        background: rgba(255, 68, 68, 0.1);
        border: 1px solid #ff4444;
        color: #ff4444;
        display: block;
    }
    
    .loading {
        opacity: 0.6;
        pointer-events: none;
    }
    
    .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid #00ff88;
        border-top: 2px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Переключение табов
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.bookmaker-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // Убираем активный класс со всех кнопок и контента
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Добавляем активный класс к выбранной кнопке и контенту
            this.classList.add('active');
            document.getElementById(targetTab).classList.add('active');
        });
    });
    
    // 1XBET API
    setup1XBET();
    setup1WIN();
    setupMELBET();
    setupMOSTBET();
    
    function setup1XBET() {
        // Баланс
        document.getElementById('1xbet-balance').addEventListener('click', async function() {
            await makeAPICall('1xbet-balance', '{% url "bot_control:api_1xbet_balance" %}', 'GET');
        });
        
        // Поиск игрока
        document.getElementById('1xbet-search').addEventListener('click', async function() {
            const playerId = document.getElementById('1xbet-search-id').value.trim();
            if (!playerId) {
                showResult('1xbet-search-result', 'Введите ID игрока', 'error');
                return;
            }
            await makeAPICall('1xbet-search', '{% url "bot_control:api_1xbet_search_player" %}', 'POST', { user_id: playerId });
        });
        
        // Пополнение
        document.getElementById('1xbet-deposit').addEventListener('click', async function() {
            const playerId = document.getElementById('1xbet-deposit-id').value.trim();
            const amount = document.getElementById('1xbet-deposit-amount').value.trim();
            if (!playerId || !amount) {
                showResult('1xbet-deposit-result', 'Заполните все поля', 'error');
                return;
            }
            await makeAPICall('1xbet-deposit', '{% url "bot_control:api_1xbet_deposit" %}', 'POST', { user_id: playerId, amount: parseFloat(amount) });
        });
    }
    
    function setup1WIN() {
        // Пополнение
        document.getElementById('1win-deposit').addEventListener('click', async function() {
            const playerId = document.getElementById('1win-deposit-id').value.trim();
            const amount = document.getElementById('1win-deposit-amount').value.trim();
            if (!playerId || !amount) {
                showResult('1win-deposit-result', 'Заполните все поля', 'error');
                return;
            }
            await makeAPICall('1win-deposit', '{% url "bot_control:api_1win_deposit" %}', 'POST', { user_id: playerId, amount: parseFloat(amount) });
        });
        
        // Вывод
        document.getElementById('1win-withdraw').addEventListener('click', async function() {
            const playerId = document.getElementById('1win-withdraw-id').value.trim();
            const amount = document.getElementById('1win-withdraw-amount').value.trim();
            if (!playerId || !amount) {
                showResult('1win-withdraw-result', 'Заполните все поля', 'error');
                return;
            }
            await makeAPICall('1win-withdraw', '{% url "bot_control:api_1win_withdrawal" %}', 'POST', { user_id: playerId, amount: parseFloat(amount) });
        });
    }
    
    function setupMELBET() {
        // Баланс
        document.getElementById('melbet-balance').addEventListener('click', async function() {
            await makeAPICall('melbet-balance', '{% url "bot_control:api_melbet_balance" %}', 'GET');
        });
        
        // Поиск игрока
        document.getElementById('melbet-search').addEventListener('click', async function() {
            const playerId = document.getElementById('melbet-search-id').value.trim();
            if (!playerId) {
                showResult('melbet-search-result', 'Введите ID игрока', 'error');
                return;
            }
            await makeAPICall('melbet-search', '{% url "bot_control:api_melbet_search_player" %}', 'POST', { user_id: playerId });
        });
        
        // Пополнение
        document.getElementById('melbet-deposit').addEventListener('click', async function() {
            const playerId = document.getElementById('melbet-deposit-id').value.trim();
            const amount = document.getElementById('melbet-deposit-amount').value.trim();
            if (!playerId || !amount) {
                showResult('melbet-deposit-result', 'Заполните все поля', 'error');
                return;
            }
            await makeAPICall('melbet-deposit', '{% url "bot_control:api_melbet_deposit" %}', 'POST', { user_id: playerId, amount: parseFloat(amount) });
        });
    }
    
    function setupMOSTBET() {
        // Баланс
        document.getElementById('mostbet-balance').addEventListener('click', async function() {
            await makeAPICall('mostbet-balance', '{% url "bot_control:api_mostbet_balance" %}', 'GET');
        });
        
        // Поиск игрока
        document.getElementById('mostbet-search').addEventListener('click', async function() {
            const playerId = document.getElementById('mostbet-search-id').value.trim();
            if (!playerId) {
                showResult('mostbet-search-result', 'Введите ID игрока', 'error');
                return;
            }
            await makeAPICall('mostbet-search', '{% url "bot_control:api_mostbet_search_player" %}', 'POST', { user_id: playerId });
        });
        
        // Пополнение
        document.getElementById('mostbet-deposit').addEventListener('click', async function() {
            const playerId = document.getElementById('mostbet-deposit-id').value.trim();
            const amount = document.getElementById('mostbet-deposit-amount').value.trim();
            if (!playerId || !amount) {
                showResult('mostbet-deposit-result', 'Заполните все поля', 'error');
                return;
            }
            await makeAPICall('mostbet-deposit', '{% url "bot_control:api_mostbet_deposit" %}', 'POST', { user_id: playerId, amount: parseFloat(amount) });
        });
        
        // Вывод
        document.getElementById('mostbet-withdraw').addEventListener('click', async function() {
            const playerId = document.getElementById('mostbet-withdraw-id').value.trim();
            const amount = document.getElementById('mostbet-withdraw-amount').value.trim();
            if (!playerId || !amount) {
                showResult('mostbet-withdraw-result', 'Заполните все поля', 'error');
                return;
            }
            await makeAPICall('mostbet-withdraw', '{% url "bot_control:api_mostbet_withdrawal" %}', 'POST', { user_id: playerId, amount: parseFloat(amount) });
        });
    }
    
    async function makeAPICall(buttonId, url, method, data = null) {
        const button = document.getElementById(buttonId);
        const resultId = buttonId + '-result';
        
        setLoading(button, true);
        hideResult(resultId);
        
        try {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            const response = await fetch(url, options);
            const result = await response.json();
            
            if (result.success) {
                showResult(resultId, JSON.stringify(result, null, 2), 'success');
            } else {
                showResult(resultId, result.error || 'Ошибка API', 'error');
            }
        } catch (error) {
            console.error('API Error:', error);
            showResult(resultId, 'Ошибка соединения', 'error');
        } finally {
            setLoading(button, false);
        }
    }
    
    function setLoading(button, loading) {
        if (loading) {
            button.classList.add('loading');
            button.disabled = true;
            const originalText = button.innerHTML;
            button.setAttribute('data-original-text', originalText);
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Загрузка...';
        } else {
            button.classList.remove('loading');
            button.disabled = false;
            const originalText = button.getAttribute('data-original-text');
            if (originalText) {
                button.innerHTML = originalText;
            }
        }
    }
    
    function showResult(resultId, message, type) {
        const resultElement = document.getElementById(resultId);
        resultElement.textContent = message;
        resultElement.className = `api-result ${type}`;
    }
    
    function hideResult(resultId) {
        const resultElement = document.getElementById(resultId);
        resultElement.className = 'api-result';
    }
    
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
</script>
{% endblock %}




























