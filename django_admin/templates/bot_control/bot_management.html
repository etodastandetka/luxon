{% extends 'base.html' %}
{% load static %}
<!-- UPDATED: Modern design with gradients and animations - {{ "now"|date:"Y-m-d H:i:s" }} -->

{% block title %}Управление ботом - Luxon{% endblock %}

{% block extra_head %}
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
{% endblock %}

{% block header_icon %}settings{% endblock %}
{% block header_title %}<i class="fas fa-cog"></i> Управление ботом{% endblock %}
{% block header_subtitle %}Настройки системы и банков{% endblock %}

{% block content %}
{% csrf_token %}
<div class="financial-interface">
    <!-- Основные настройки -->
    <div class="control-panel">
        <div class="panel-header">
            <div class="panel-icon"><i class="fas fa-cog"></i></div>
            <div class="panel-info">
                <h2>Основные настройки</h2>
                <p>Управление статусом бота и сообщениями</p>
            </div>
        </div>
        
        <div class="control-group">
            <div class="control-item">
                <div class="control-label">
                    <span class="label-title">Пауза бота</span>
                    <span class="label-desc">Временно отключить бота для обслуживания</span>
                </div>
                <div class="control-switch">
                    <input type="checkbox" id="bot-pause" class="financial-switch">
                    <label for="bot-pause" class="switch-label">
                        <span class="switch-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="control-item">
                <div class="control-label">
                    <span class="label-title">Сообщение обслуживания</span>
                    <span class="label-desc">Текст для пользователей во время паузы</span>
                </div>
                <div class="control-input-full">
                    <textarea id="maintenance-message" class="financial-textarea" placeholder="Введите сообщение обслуживания..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Настройки пополнений -->
    <div class="control-panel">
        <div class="panel-header">
            <div class="panel-icon"><i class="fas fa-coins"></i></div>
            <div class="panel-info">
                <h2>Настройки пополнений</h2>
                <p>Управление депозитами и банками</p>
            </div>
        </div>
        
        <div class="control-group">
            <div class="control-item">
                <div class="control-label">
                    <span class="label-title">Включить пополнения</span>
                    <span class="label-desc">Разрешить пользователям пополнять баланс</span>
                </div>
                <div class="control-switch">
                    <input type="checkbox" id="deposits-enabled" class="financial-switch">
                    <label for="deposits-enabled" class="switch-label">
                        <span class="switch-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="banks-panel">
                <div class="banks-header">
                    <h3>Доступные банки</h3>
                    <div class="banks-count">
                        <span id="deposit-count">0</span> из 6
                    </div>
                </div>
                
                <div class="banks-grid">
                    <div class="bank-card" data-bank="mbank">
                        <div class="bank-logo">
                            <img src="{% static 'images/mbank.png' %}" alt="MBank">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">MBank</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="deposit-mbank" class="bank-checkbox">
                            <label for="deposit-mbank" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="demir">
                        <div class="bank-logo">
                            <img src="{% static 'images/demirbank.jpg' %}" alt="DemirBank">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">DemirBank</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="deposit-demir" class="bank-checkbox">
                            <label for="deposit-demir" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="balance">
                        <div class="bank-logo">
                            <img src="{% static 'images/balance.jpg' %}" alt="Balance.kg">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">Balance.kg</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="deposit-balance" class="bank-checkbox">
                            <label for="deposit-balance" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="omoney">
                        <div class="bank-logo">
                            <img src="{% static 'images/omoney.jpg' %}" alt="O!Money">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">O!Money</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="deposit-omoney" class="bank-checkbox">
                            <label for="deposit-omoney" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="megapay">
                        <div class="bank-logo">
                            <img src="{% static 'images/megapay.jpg' %}" alt="MegaPay">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">MegaPay</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="deposit-megapay" class="bank-checkbox">
                            <label for="deposit-megapay" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="bakai">
                        <div class="bank-logo">
                            <img src="/static/images/bakai.jpg" alt="Bakai">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">Bakai</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="deposit-bakai" class="bank-checkbox">
                            <label for="deposit-bakai" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Настройки выводов -->
    <div class="control-panel">
        <div class="panel-header">
            <div class="panel-icon"><i class="fas fa-arrow-up"></i></div>
            <div class="panel-info">
                <h2>Настройки выводов</h2>
                <p>Управление выводами средств</p>
            </div>
        </div>
        
        <div class="control-group">
            <div class="control-item">
                <div class="control-label">
                    <span class="label-title">Включить выводы</span>
                    <span class="label-desc">Разрешить пользователям выводить средства</span>
                </div>
                <div class="control-switch">
                    <input type="checkbox" id="withdrawals-enabled" class="financial-switch">
                    <label for="withdrawals-enabled" class="switch-label">
                        <span class="switch-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="banks-panel">
                <div class="banks-header">
                    <h3>Доступные банки</h3>
                    <div class="banks-count">
                        <span id="withdrawal-count">0</span> из 6
                    </div>
                </div>
                
                <div class="banks-grid">
                    <div class="bank-card" data-bank="kompanion">
                        <div class="bank-logo">
                            <img src="{% static 'images/companion.png' %}" alt="Компаньон">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">Компаньон</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="withdrawal-kompanion" class="bank-checkbox">
                            <label for="withdrawal-kompanion" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="odengi">
                        <div class="bank-logo">
                            <img src="{% static 'images/omoney.jpg' %}" alt="O!Money">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">O!Money</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="withdrawal-odengi" class="bank-checkbox">
                            <label for="withdrawal-odengi" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="bakai">
                        <div class="bank-logo">
                            <img src="/static/images/bakai.jpg" alt="Bakai">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">Bakai</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="withdrawal-bakai" class="bank-checkbox">
                            <label for="withdrawal-bakai" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="balance">
                        <div class="bank-logo">
                            <img src="{% static 'images/balance.jpg' %}" alt="Balance.kg">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">Balance.kg</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="withdrawal-balance" class="bank-checkbox">
                            <label for="withdrawal-balance" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="megapay">
                        <div class="bank-logo">
                            <img src="{% static 'images/megapay.jpg' %}" alt="MegaPay">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">MegaPay</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="withdrawal-megapay" class="bank-checkbox">
                            <label for="withdrawal-megapay" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bank-card" data-bank="mbank">
                        <div class="bank-logo">
                            <img src="{% static 'images/mbank.png' %}" alt="MBank">
                        </div>
                        <div class="bank-info">
                            <div class="bank-name">MBank</div>
                            <div class="bank-status">Доступен</div>
                        </div>
                        <div class="bank-control">
                            <input type="checkbox" id="withdrawal-mbank" class="bank-checkbox">
                            <label for="withdrawal-mbank" class="checkbox-label">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Настройки канала -->
    <div class="control-panel">
        <div class="panel-header">
            <div class="panel-icon"><i class="fas fa-bullhorn"></i></div>
            <div class="panel-info">
                <h2>Настройки канала</h2>
                <p>Управление информационным каналом</p>
            </div>
        </div>
        
        <div class="control-group">
            <div class="control-item">
                <div class="control-label">
                    <span class="label-title">Включить канал</span>
                    <span class="label-desc">Активировать информационный канал</span>
                </div>
                <div class="control-switch">
                    <input type="checkbox" id="channel-enabled" class="financial-switch">
                    <label for="channel-enabled" class="switch-label">
                        <span class="switch-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="control-item">
                <div class="control-label">
                    <span class="label-title">Название канала</span>
                    <span class="label-desc">Имя канала для отображения</span>
                </div>
                <div class="control-input-full">
                    <input type="text" id="channel-name" class="financial-input" placeholder="Введите название канала">
                </div>
            </div>
            
            <div class="control-item">
                <div class="control-label">
                    <span class="label-title">ID канала</span>
                    <span class="label-desc">Уникальный идентификатор канала (@channel_id)</span>
                </div>
                <div class="control-input-full">
                    <input type="text" id="channel-id" class="financial-input" placeholder="Введите ID канала (например: @mychannel)">
                </div>
            </div>
            
            <div class="control-item">
                <div class="control-label">
                    <span class="label-title">Username канала</span>
                    <span class="label-desc">Имя пользователя канала для ссылок</span>
                </div>
                <div class="control-input-full">
                    <input type="text" id="channel-username" class="financial-input" placeholder="Введите username канала (например: mychannel)">
                </div>
            </div>
        </div>
    </div>

    <!-- Панель управления -->
    <div class="action-panel">
        <button id="save-settings" class="primary-button">
            <span class="button-icon"><i class="fas fa-save"></i></span>
            <span class="button-text">Сохранить настройки</span>
        </button>
        <div id="save-status" class="status-indicator"></div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Современный финансовый интерфейс с улучшенным дизайном */
:root {
    --bg-primary: #0a1a0a;
    --bg-secondary: #1e2e1e;
    --bg-tertiary: #2a3a2a;
    --bg-panel: #1e2e1e;
    --bg-card: #233223;
    --text-primary: #ffffff;
    --text-secondary: #a8cfa8;
    --text-muted: #7db57d;
    --border-primary: #3d663d;
    --border-secondary: #2a412a;
    --accent-green: #16a34a;
    --accent-green-hover: #22c55e;
    --accent-blue: #3b82f6;
    --accent-blue-hover: #2563eb;
    --accent-purple: #8b5cf6;
    --accent-purple-hover: #7c3aed;
    --success: #16a34a;
    --error: #ef4444;
    --warning: #f59e0b;
    --gradient-primary: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
    --gradient-success: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
    --gradient-card: linear-gradient(135deg, rgba(22, 163, 74, 0.1) 0%, rgba(22, 163, 74, 0.05) 100%);
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.2);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.25);
    --shadow-glow: 0 0 20px rgba(22, 163, 74, 0.3);
}

/* Сброс стилей */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: var(--bg-primary) !important;
    background-image: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.05) 0%, transparent 50%);
    color: var(--text-primary) !important;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif !important;
    font-size: 14px !important;
    line-height: 1.5 !important;
    min-height: 100vh !important;
    position: relative;
    overflow-x: hidden;
}

/* Переопределение базовых стилей */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary) !important;
    font-weight: 600 !important;
}

p {
    color: var(--text-secondary) !important;
}

input, textarea, select {
    color: var(--text-primary) !important;
    background: var(--bg-secondary) !important;
    border: 1px solid var(--border-primary) !important;
}

input::placeholder, textarea::placeholder {
    color: var(--text-muted) !important;
}

/* Удален дублирующийся код */

.financial-interface {
    max-width: 480px;
    margin: 0 auto;
    padding: 20px;
    background: transparent;
    min-height: 100vh;
    color: var(--text-primary);
    position: relative;
    z-index: 1;
}

/* Улучшенные стили для текста */
.financial-interface h1,
.financial-interface h2,
.financial-interface h3,
.financial-interface h4,
.financial-interface h5,
.financial-interface h6 {
    color: var(--text-primary) !important;
    font-weight: 600 !important;
    margin: 0 !important;
}

.financial-interface p {
    color: var(--text-secondary) !important;
    margin: 0 !important;
}

.financial-interface span {
    color: inherit !important;
}

.financial-interface div {
    color: inherit !important;
}

/* Панели управления */
.control-panel {
    background: var(--gradient-card);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    margin-bottom: 24px;
    overflow: hidden;
    box-shadow: var(--shadow-md);
    position: relative;
    transition: all 0.3s ease;
}

.control-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
}

.control-panel:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    border-color: rgba(255, 255, 255, 0.2);
}

.panel-header {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
    backdrop-filter: blur(10px);
    padding: 20px 24px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    gap: 16px;
    position: relative;
}

.panel-icon {
    font-size: 20px;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--gradient-primary);
    border-radius: 12px;
    border: 1px solid rgba(22, 163, 74, 0.3);
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
    color: white;
}

.panel-icon i {
    font-size: 18px;
    z-index: 2;
    position: relative;
}

.panel-icon::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
    pointer-events: none;
}

.panel-info h2 {
    font-size: 16px !important;
    font-weight: 600 !important;
    color: var(--text-primary) !important;
    margin: 0 0 2px 0 !important;
}

.panel-info p {
    font-size: 12px !important;
    color: var(--text-secondary) !important;
    margin: 0 !important;
}

/* Группы управления */
.control-group {
    padding: 20px;
}

.label-title {
    display: block !important;
    font-size: 14px !important;
    font-weight: 500 !important;
    color: var(--text-primary) !important;
    margin-bottom: 4px !important;
}

.label-desc {
    display: block !important;
    font-size: 12px !important;
    color: var(--text-secondary) !important;
    line-height: 1.4 !important;
}

/* Переключатели */
.control-switch {
    flex-shrink: 0;
}

.financial-switch {
    display: none;
}

.switch-label {
    position: relative;
    display: block;
    width: 52px;
    height: 28px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.switch-slider {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 22px;
    height: 22px;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

.switch-slider::before {
    content: '';
    position: absolute;
    width: 8px;
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.financial-switch:checked + .switch-label {
    background: var(--gradient-success);
    border-color: var(--accent-green);
    box-shadow: var(--shadow-glow);
}

.financial-switch:checked + .switch-label .switch-slider {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    transform: translateX(24px);
    box-shadow: 0 4px 12px rgba(0, 212, 170, 0.3);
}

.financial-switch:checked + .switch-label .switch-slider::before {
    opacity: 1;
    background: var(--accent-green);
}

.switch-label:hover {
    border-color: var(--accent-green);
    box-shadow: 0 0 0 4px rgba(0, 212, 170, 0.1);
    transform: scale(1.05);
}

/* Формы */
.control-input {
    flex: 1;
    max-width: 200px;
}

.control-input-full {
    width: 100%;
    margin-top: 12px;
}

.control-item {
    display: flex;
    flex-direction: column;
    padding: 20px 0;
    border-bottom: 1px solid var(--border-secondary);
    gap: 12px;
}

.control-item:last-child {
    border-bottom: none;
}

.control-label {
    width: 100%;
    margin-bottom: 8px;
}

.financial-input, .financial-textarea {
    width: 100%;
    padding: 20px 24px;
    background: rgba(30, 46, 30, 0.7);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(22, 163, 74, 0.3);
    border-radius: 24px;
    color: var(--text-primary);
    font-size: 16px;
    font-family: inherit;
    font-weight: 500;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        inset 0 4px 12px rgba(0, 0, 0, 0.15),
        0 6px 20px rgba(22, 163, 74, 0.15);
    position: relative;
    overflow: hidden;
}

.financial-input::before, .financial-textarea::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(22, 163, 74, 0.05) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.financial-input:focus, .financial-textarea:focus {
    outline: none;
    border-color: var(--accent-green);
    background: rgba(30, 46, 30, 0.8);
    box-shadow: 
        0 0 0 4px rgba(22, 163, 74, 0.2),
        inset 0 2px 8px rgba(0, 0, 0, 0.1),
        0 8px 24px rgba(22, 163, 74, 0.2);
    transform: translateY(-2px);
}

.financial-input:focus::before, .financial-textarea:focus::before {
    opacity: 1;
}

.financial-textarea {
    min-height: 100px;
    resize: vertical;
    font-family: inherit;
    line-height: 1.6;
    padding-top: 20px;
    padding-bottom: 20px;
}

.financial-input::placeholder, .financial-textarea::placeholder {
    color: var(--text-muted);
    opacity: 0.8;
    font-weight: 400;
    transition: all 0.3s ease;
}

.financial-input:focus::placeholder, .financial-textarea:focus::placeholder {
    opacity: 0.6;
    transform: translateY(-2px);
}

/* Улучшенные эффекты при наведении */
.financial-input:hover:not(:focus), .financial-textarea:hover:not(:focus) {
    border-color: rgba(22, 163, 74, 0.4);
    background: rgba(30, 46, 30, 0.7);
    transform: translateY(-1px);
    box-shadow: 
        inset 0 2px 8px rgba(0, 0, 0, 0.1),
        0 6px 16px rgba(22, 163, 74, 0.15);
}

/* Панель банков */
.banks-panel {
    margin-top: 20px;
}

.banks-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-secondary);
}

.banks-header h3 {
    font-size: 14px !important;
    font-weight: 600 !important;
    color: var(--text-primary) !important;
    margin: 0 !important;
}

.banks-count {
    font-size: 12px;
    color: var(--text-secondary);
    background: var(--bg-tertiary);
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid var(--border-primary);
}

.banks-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.bank-card {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 16px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.bank-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.bank-card:hover {
    border-color: var(--accent-blue);
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-4px);
    box-shadow: var(--shadow-md);
}

.bank-card:hover::before {
    opacity: 1;
}

.bank-card.active {
    border-color: var(--accent-green);
    background: rgba(0, 212, 170, 0.1);
    box-shadow: var(--shadow-glow);
}

.bank-card.active::before {
    opacity: 1;
    background: linear-gradient(135deg, rgba(0, 212, 170, 0.1) 0%, transparent 50%);
}

.bank-logo {
    width: 48px;
    height: 48px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    background: rgba(22, 163, 74, 0.1);
    border: 1px solid rgba(22, 163, 74, 0.2);
    overflow: hidden;
    transition: all 0.3s ease;
}

.bank-logo img {
    width: 36px;
    height: 36px;
    object-fit: contain;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.bank-card:hover .bank-logo {
    background: rgba(22, 163, 74, 0.2);
    border-color: rgba(22, 163, 74, 0.4);
    transform: scale(1.05);
}

.bank-card:hover .bank-logo img {
    transform: scale(1.1);
}

.bank-info {
    margin-bottom: 8px;
}

.bank-name {
    font-size: 13px !important;
    font-weight: 500 !important;
    color: var(--text-primary) !important;
    margin-bottom: 2px !important;
}

.bank-status {
    font-size: 11px !important;
    color: var(--text-secondary) !important;
}

.bank-control {
    display: flex;
    justify-content: flex-end;
}

.bank-checkbox {
    display: none;
}

.checkbox-label {
    position: relative;
    display: block;
    width: 20px;
    height: 20px;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.checkmark {
    position: absolute;
    top: 3px;
    left: 6px;
    width: 6px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
}

.bank-checkbox:checked + .checkbox-label {
    background: var(--gradient-success);
    border-color: var(--accent-green);
    box-shadow: 0 0 0 4px rgba(0, 212, 170, 0.2);
    transform: scale(1.1);
}

.bank-checkbox:checked + .checkbox-label .checkmark {
    opacity: 1;
    transform: rotate(45deg) scale(1.2);
}

.checkbox-label:hover {
    border-color: var(--accent-green);
    box-shadow: 0 0 0 4px rgba(0, 212, 170, 0.1);
    transform: scale(1.05);
}

/* Панель действий */
.action-panel {
    text-align: center;
    margin-top: 30px;
    padding: 20px;
}

.primary-button {
    background: var(--gradient-success);
    border: none;
    border-radius: 12px;
    padding: 16px 32px;
    color: white;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-flex;
    align-items: center;
    gap: 12px;
    box-shadow: var(--shadow-md);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.primary-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.primary-button:hover {
    background: var(--gradient-success);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg), var(--shadow-glow);
}

.primary-button:hover::before {
    left: 100%;
}

.primary-button:active {
    transform: translateY(0);
    box-shadow: var(--shadow-md);
}

.button-icon {
    font-size: 16px;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
    z-index: 2;
    position: relative;
}

.button-icon i {
    font-size: 16px;
}

.status-indicator {
    margin-top: 16px;
    font-size: 14px;
    font-weight: 600;
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 8px 16px;
    border-radius: 8px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: inline-block;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-indicator.show {
    opacity: 1;
    transform: translateY(0);
}

.status-indicator.success {
    color: var(--success);
    background: rgba(0, 212, 170, 0.1);
    border-color: var(--success);
    box-shadow: 0 0 20px rgba(0, 212, 170, 0.2);
}

.status-indicator.error {
    color: var(--error);
    background: rgba(255, 107, 107, 0.1);
    border-color: var(--error);
    box-shadow: 0 0 20px rgba(255, 107, 107, 0.2);
}

.status-indicator.loading {
    color: var(--accent-blue);
    background: rgba(77, 171, 247, 0.1);
    border-color: var(--accent-blue);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Адаптивность */
@media (max-width: 480px) {
    .financial-interface {
        padding: 16px;
        max-width: 100%;
    }
    
    .control-group {
        padding: 16px;
    }
    
    .control-item {
        flex-direction: column;
        gap: 16px;
        padding: 20px 0;
    }
    
    .control-input {
        max-width: none;
        width: 100%;
    }
    
    .banks-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .bank-card {
        padding: 20px;
    }
    
    .panel-header {
        padding: 16px 20px;
        gap: 12px;
    }
    
    .panel-icon {
        width: 40px;
        height: 40px;
        font-size: 20px;
    }
    
    .primary-button {
        width: 100%;
        padding: 18px 24px;
        font-size: 15px;
    }
    
    .switch-label {
        width: 48px;
        height: 26px;
    }
    
    .switch-slider {
        width: 20px;
        height: 20px;
    }
    
    .financial-switch:checked + .switch-label .switch-slider {
        transform: translateX(22px);
    }
}

/* Дополнительные анимации */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.control-panel {
    animation: fadeInUp 0.6s ease-out;
}

.control-panel:nth-child(1) { animation-delay: 0.1s; }
.control-panel:nth-child(2) { animation-delay: 0.2s; }
.control-panel:nth-child(3) { animation-delay: 0.3s; }
.control-panel:nth-child(4) { animation-delay: 0.4s; }

/* Скроллбар */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-primary);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--accent-blue-hover) 0%, var(--accent-purple-hover) 100%);
    box-shadow: 0 0 10px rgba(77, 171, 247, 0.3);
}

/* Дополнительные эффекты */
.financial-interface::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.02) 0%, transparent 50%);
    pointer-events: none;
    z-index: -1;
}

/* Улучшенные эффекты для элементов управления */
.control-item {
    position: relative;
    overflow: hidden;
}

.control-item::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(22, 163, 74, 0.2), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.control-item:hover::after {
    opacity: 1;
}

/* Эффект загрузки */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 14, 26, 0.8);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.loading-overlay.show {
    opacity: 1;
    visibility: visible;
}

.loading-spinner {
    width: 48px;
    height: 48px;
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-top: 3px solid var(--accent-green);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Профессиональный финансовый интерфейс
if (window.financialInterfaceInitialized) {
    console.log('⚠️ Интерфейс уже инициализирован');
} else {
    window.financialInterfaceInitialized = true;
    
    // Загрузка настроек
    async function loadAllSettings() {
        try {
            console.log('🔄 Загрузка настроек системы...');
            
            // Загрузка общих настроек бота
            const botResponse = await fetch('{% url "bot_control:api_get_bot_control" %}');
            if (!botResponse.ok) throw new Error(`HTTP error! status: ${botResponse.status}`);
            const botData = await botResponse.json();
            
            const pauseElement = document.getElementById('bot-pause');
            const messageElement = document.getElementById('maintenance-message');
            
            if (pauseElement) pauseElement.checked = botData.pause;
            if (messageElement) messageElement.value = botData.maintenance_message || '';

            // Загрузка настроек депозитов
            const depositResponse = await fetch('{% url "bot_control:api_get_deposit_settings" %}');
            if (!depositResponse.ok) throw new Error(`Deposit settings HTTP error! status: ${depositResponse.status}`);
            const depositData = await depositResponse.json();
            
            const depositsEnabledElement = document.getElementById('deposits-enabled');
            if (depositsEnabledElement) {
                // Нормализация значения enabled (может быть строкой "true"/"false" или boolean)
                const depositsEnabled = depositData.enabled === true || depositData.enabled === 'true' || depositData.enabled === 1 || depositData.enabled === '1';
                depositsEnabledElement.checked = depositsEnabled;
                console.log('✅ Депозиты enabled (raw):', depositData.enabled, '-> (normalized):', depositsEnabled);
            }
            
            // Сброс чекбоксов депозитов
            document.querySelectorAll('input[id^="deposit-"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Установка банков для депозитов
            if (depositData.banks && Array.isArray(depositData.banks)) {
                console.log('✅ Банки для депозитов:', depositData.banks);
                depositData.banks.forEach(bank => {
                    const checkbox = document.getElementById(`deposit-${bank}`);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`✅ Установлен чекбокс: deposit-${bank}`);
                    } else {
                        console.warn(`⚠️ Чекбокс не найден: deposit-${bank}`);
                    }
                });
            } else {
                console.warn('⚠️ depositData.banks не является массивом:', depositData.banks);
            }

            // Загрузка настроек выводов
            const withdrawalResponse = await fetch('{% url "bot_control:api_get_withdrawal_settings" %}');
            if (!withdrawalResponse.ok) throw new Error(`Withdrawal settings HTTP error! status: ${withdrawalResponse.status}`);
            const withdrawalResponseData = await withdrawalResponse.json();
            
            // API возвращает {'success': True, 'data': {...}} или прямой объект
            const withdrawalData = withdrawalResponseData.data || withdrawalResponseData;
            
            const withdrawalsEnabledElement = document.getElementById('withdrawals-enabled');
            if (withdrawalsEnabledElement) {
                // Нормализация значения enabled (может быть строкой "true"/"false" или boolean)
                const withdrawalsEnabled = withdrawalData.enabled === true || withdrawalData.enabled === 'true' || withdrawalData.enabled === 1 || withdrawalData.enabled === '1';
                withdrawalsEnabledElement.checked = withdrawalsEnabled;
                console.log('✅ Выводы enabled (raw):', withdrawalData.enabled, '-> (normalized):', withdrawalsEnabled);
                console.log('✅ Выводы banks:', withdrawalData.banks);
            }
            
            // Сброс чекбоксов выводов
            document.querySelectorAll('input[id^="withdrawal-"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Установка банков для выводов
            if (withdrawalData.banks && Array.isArray(withdrawalData.banks)) {
                console.log('✅ Банки для выводов:', withdrawalData.banks);
                withdrawalData.banks.forEach(bank => {
                    const checkbox = document.getElementById(`withdrawal-${bank}`);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`✅ Установлен чекбокс: withdrawal-${bank}`);
                    } else {
                        console.warn(`⚠️ Чекбокс не найден: withdrawal-${bank}`);
                    }
                });
            } else {
                console.warn('⚠️ withdrawalData.banks не является массивом:', withdrawalData.banks);
            }

            // Загрузка настроек канала
            const channelResponse = await fetch('{% url "bot_control:api_get_channel_settings" %}');
            if (!channelResponse.ok) throw new Error(`Channel settings HTTP error! status: ${channelResponse.status}`);
            const channelData = await channelResponse.json();
            
            const channelEnabledElement = document.getElementById('channel-enabled');
            if (channelEnabledElement) channelEnabledElement.checked = channelData.enabled;
            
            const channelNameElement = document.getElementById('channel-name');
            const channelIdElement = document.getElementById('channel-id');
            const channelUsernameElement = document.getElementById('channel-username');
            
            if (channelNameElement) channelNameElement.value = channelData.name || '';
            if (channelIdElement) channelIdElement.value = channelData.channel_id || '';
            if (channelUsernameElement) channelUsernameElement.value = channelData.channel_username || '';
            
            // Обновление счетчиков
            updateBankCounters();
            
            // Обновляем состояние переключателей визуально
            const depositsSwitch = document.getElementById('deposits-enabled');
            if (depositsSwitch) {
                depositsSwitch.dispatchEvent(new Event('change', { bubbles: true }));
            }
            
            const withdrawalsSwitch = document.getElementById('withdrawals-enabled');
            if (withdrawalsSwitch) {
                withdrawalsSwitch.dispatchEvent(new Event('change', { bubbles: true }));
            }
            
            console.log('✅ Настройки системы загружены');
            
        } catch (error) {
            console.error('❌ Ошибка загрузки настроек:', error);
            showStatus('Ошибка загрузки настроек: ' + error.message, 'error');
        }
    }

    // Переменная для отслеживания процесса сохранения и debounce таймера
    let isSaving = false;
    let saveTimeout = null;
    
    // Сохранение настроек
    async function saveAllSettings(showLoading = true) {
        // Если уже идет сохранение, пропускаем
        if (isSaving) {
            console.log('⏳ Сохранение уже выполняется, пропускаем...');
            return;
        }
        
        try {
            isSaving = true;
            if (showLoading) {
                console.log('💾 Сохранение настроек системы...');
                showStatus('Сохранение...', 'loading');
            }
            
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
            if (!csrfToken) {
                console.error('❌ CSRF token не найден в DOM');
                console.log('Проверяемые элементы:', document.querySelectorAll('input[type="hidden"]'));
                throw new Error('CSRF token не найден. Обновите страницу.');
            }

            // Сохранение общих настроек бота
            await fetch('{% url "bot_control:api_save_bot_control" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken.value
                },
                body: JSON.stringify({
                    pause: document.getElementById('bot-pause')?.checked || false,
                    maintenance_message: document.getElementById('maintenance-message')?.value || ''
                })
            });

            // Сбор банков для депозитов
            const depositBanks = [];
            const depositCheckboxes = document.querySelectorAll('input[id^="deposit-"]:checked');
            console.log('📋 Найдено чекбоксов депозитов:', depositCheckboxes.length);
            depositCheckboxes.forEach(checkbox => {
                const bankCode = checkbox.id.replace('deposit-', '');
                depositBanks.push(bankCode);
                console.log('  - Банк для депозита:', bankCode);
            });
            
            const depositsEnabled = document.getElementById('deposits-enabled')?.checked || false;
            console.log('💾 Сохранение депозитов - enabled:', depositsEnabled, 'banks:', depositBanks);

            // Сохранение настроек депозитов
            const depositResponse = await fetch('{% url "bot_control:api_save_deposit_settings" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken.value
                },
                body: JSON.stringify({
                    enabled: depositsEnabled,
                    banks: depositBanks
                })
            });
            
            const depositResult = await depositResponse.json().catch(() => ({}));
            if (!depositResponse.ok || !depositResult.success) {
                console.error('❌ Ошибка сохранения депозитов:', depositResult);
                throw new Error(depositResult.error || 'Ошибка сохранения настроек депозитов');
            }
            console.log('✅ Депозиты успешно сохранены:', depositResult);

            // Сбор банков для выводов
            const withdrawalBanks = [];
            const withdrawalCheckboxes = document.querySelectorAll('input[id^="withdrawal-"]:checked');
            console.log('📋 Найдено чекбоксов выводов:', withdrawalCheckboxes.length);
            withdrawalCheckboxes.forEach(checkbox => {
                const bankCode = checkbox.id.replace('withdrawal-', '');
                withdrawalBanks.push(bankCode);
                console.log('  - Банк для вывода:', bankCode);
            });
            
            const withdrawalsEnabled = document.getElementById('withdrawals-enabled')?.checked || false;
            console.log('💾 Сохранение выводов - enabled:', withdrawalsEnabled, 'banks:', withdrawalBanks);

            // Сохранение настроек выводов
            const withdrawalResponse = await fetch('{% url "bot_control:api_save_withdrawal_settings" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken.value
                },
                body: JSON.stringify({
                    enabled: withdrawalsEnabled,
                    banks: withdrawalBanks
                })
            });
            
            const withdrawalResult = await withdrawalResponse.json().catch(() => ({}));
            if (!withdrawalResponse.ok || !withdrawalResult.success) {
                console.error('❌ Ошибка сохранения выводов:', withdrawalResult);
                throw new Error(withdrawalResult.error || 'Ошибка сохранения настроек выводов');
            }
            console.log('✅ Выводы успешно сохранены:', withdrawalResult);

            // Сохранение настроек канала
            await fetch('{% url "bot_control:api_save_channel_settings" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken.value
                },
                body: JSON.stringify({
                    enabled: document.getElementById('channel-enabled')?.checked || false,
                    name: document.getElementById('channel-name')?.value || '',
                    channel_id: document.getElementById('channel-id')?.value || '',
                    channel_username: document.getElementById('channel-username')?.value || ''
                })
            });
            
            if (showLoading) {
                showStatus('Настройки сохранены', 'success');
            }
            console.log('✅ Настройки системы сохранены');
            
            // Обновляем только счетчики банков (без перезагрузки всех настроек)
            updateBankCounters();
            
        } catch (error) {
            console.error('❌ Ошибка сохранения:', error);
            showStatus('Ошибка сохранения: ' + error.message, 'error');
        } finally {
            isSaving = false;
        }
    }
    
    // Debounced версия сохранения (сохраняет только один раз после последнего изменения)
    function debouncedSaveAllSettings() {
        // Очищаем предыдущий таймер
        if (saveTimeout) {
            clearTimeout(saveTimeout);
        }
        
        // Устанавливаем новый таймер (сохранит через 1.5 секунды после последнего изменения)
        saveTimeout = setTimeout(() => {
            saveAllSettings(true);
        }, 1500);
    }

    // Показать статус
    function showStatus(message, type) {
        const status = document.getElementById('save-status');
        status.textContent = message;
        status.className = `status-indicator show ${type}`;
        
        if (type === 'success') {
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }
    }

    // Обновление счетчиков банков
    function updateBankCounters() {
        const depositCount = document.querySelectorAll('input[id^="deposit-"]:checked').length;
        const withdrawalCount = document.querySelectorAll('input[id^="withdrawal-"]:checked').length;
        
        const depositCounter = document.getElementById('deposit-count');
        const withdrawalCounter = document.getElementById('withdrawal-count');
        
        if (depositCounter) depositCounter.textContent = depositCount;
        if (withdrawalCounter) withdrawalCounter.textContent = withdrawalCount;
    }

    // Инициализация
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Инициализация финансового интерфейса');
        
        // Загружаем настройки
        setTimeout(() => {
            loadAllSettings();
        }, 100);
        
        // Обработчик кнопки сохранения
        const saveButton = document.getElementById('save-settings');
        if (saveButton) {
            saveButton.addEventListener('click', saveAllSettings);
        }
        
        // Автоматическое сохранение при изменении (с debounce)
        const autoSaveElements = [
            'bot-pause', 'maintenance-message', 'deposits-enabled', 'withdrawals-enabled', 
            'channel-enabled', 'channel-name', 'channel-id', 'channel-username'
        ];
        
        autoSaveElements.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('change', () => {
                    debouncedSaveAllSettings();
                });
            }
        });
        
        // Обработка чекбоксов банков
        document.querySelectorAll('input[id^="deposit-"], input[id^="withdrawal-"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                updateBankCounters();
                debouncedSaveAllSettings();
            });
        });
        
        // Клик по карточкам банков
        document.querySelectorAll('.bank-card').forEach(card => {
            card.addEventListener('click', function() {
                const checkbox = this.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                }
            });
        });
    });
}
</script>
{% endblock %}