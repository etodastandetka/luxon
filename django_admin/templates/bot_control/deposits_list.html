{% extends 'base.html' %}
{% load static %}

{% block title %}–ó–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ{% endblock %}

{% block header_icon %}list{% endblock %}
{% block header_title %}–ó–∞—è–≤–∫–∏{% endblock %}
{% block header_subtitle %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏{% endblock %}

{% block content %}


<!-- –í—Å–µ –∑–∞—è–≤–∫–∏ -->
{% for request in page_obj %}
{% firstof request.request_type request.type 'deposit' as rt %}
<div class="list-item" onclick="openTransaction({{ request.id }})" style="cursor: pointer; background: transparent; border: none; box-shadow: none; transition: all 0.3s ease; padding: 16px; margin-bottom: 12px;" onmouseover="this.style.backgroundColor='#1a1a1a'" onmouseout="this.style.backgroundColor='transparent'">
    <div class="list-icon" style="margin-right: 16px;">
        <div style="width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 2px solid #333; background:#0f0f0f; overflow:hidden; font-size:20px;">
            {% if rt == 'deposit' %}üí≥{% else %}üí∏{% endif %}
        </div>
    </div>
    <div class="list-content">
        <div class="list-title">
            {% if request.username %}{{ request.username }}{% else %}user_{{ request.user_id }}{% endif %}
        </div>
        <div class="list-subtitle">
            {{ request.bookmaker|upper }}{% if request.account_id %} ‚Ä¢ ID: {{ request.account_id }}{% endif %}
        </div>
        <div class="list-date" style="font-size: 11px; color: #999; margin-top: 4px;">
            {{ request.created_at|date:"d.m.Y ‚Ä¢ H:i" }}
        </div>
    </div>
    <div class="list-right" style="text-align: right;">
        <div class="list-amount" style="color: {% if rt == 'deposit' %}#00ff88{% else %}#ff4444{% endif %}; font-weight: bold; font-size: 16px; margin-bottom: 4px;">
            {% if rt == 'deposit' %}+{% else %}-{% endif %}{{ request.amount }} —Å–æ–º
        </div>
        <div class="list-status" style="display: flex; align-items: center; justify-content: flex-end; font-size: 11px; color: #999; gap:6px;">
            <div class="status-dot" style="
                width: 6px;
                height: 6px;
                border-radius: 50%;
                margin-right: 6px;
                background: {% if request.status == 'pending' %}#ffa500{% elif request.status == 'completed' %}#16a34a{% elif request.status == 'auto_completed' %}#22c55e{% elif request.status == 'rejected' %}#ff4444{% else %}#ffa500{% endif %};
            "></div>
            <span>
                {% if request.status == 'pending' %}–û–∂–∏–¥–∞–µ—Ç{% elif request.status == 'completed' %}–£—Å–ø–µ—à–Ω–æ{% elif request.status == 'auto_completed' %}–ê–≤—Ç–æ–ø–æ–ø–æ–ª–Ω–µ–Ω–æ{% elif request.status == 'rejected' %}–û—Ç–∫–ª–æ–Ω–µ–Ω–æ{% else %}{{ request.status }}{% endif %}
            </span>
        </div>
        {% if request.status == 'auto_completed' %}
        <div style="margin-top:4px; font-size:10px; color:#9aa7bd;">–∞–≤—Ç–æ–ø–æ–ø–æ–ª–Ω–µ–Ω–æ</div>
        {% endif %}
    </div>
    </div>
</div>
{% empty %}
<div class="card">
    <div class="card-body text-center">
        <i class="fas fa-inbox fa-3x mb-3 text-muted"></i>
        <h5 class="text-muted">–ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
        <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
    </div>
</div>
{% endfor %}

<script>
function openTransaction(transId) {
    window.location.href = `/bot_control/transactions/${transId}/`;
}

// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(function() {
    location.reload();
}, 30000);
</script>
{% endblock %}