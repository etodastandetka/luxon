{% extends 'dashboard/base_mobile.html' %}

{% block title %}История заявок на вывод (Рефералы){% endblock %}

{% block content %}
<style>
  .card { border-radius: 14px !important; border: 1px solid #242424 !important; background: #111 !important; }
  .page-header .header-avatar { background:#1f2937; }
  .filters { display:flex; gap:8px; flex-wrap:wrap; }
  .filters select { background:#0f0f0f; color:#e5e7eb; border:1px solid #2a2a2a; border-radius:8px; padding:8px 10px; }
  .apply { background:#1e293b; color:#c7d2fe; border:1px solid #334155; border-radius:8px; padding:8px 12px; cursor:pointer; }
  .apply:hover { background:#243044; }
  .row { display:grid; grid-template-columns: 70px 1.2fr 1.2fr 0.8fr 0.9fr 1.1fr; gap:10px; align-items:center; }
  .head { font-weight:700; color:#cde8ff; }
  .muted { color:#9aa7bd; }
  .tag { padding:4px 8px; border-radius:999px; font-size:12px; display:inline-block; }
  .ok { background:#065f46; color:#d1fae5; }
  .warn { background:#92400e; color:#fde68a; }
  .bad { background:#7f1d1d; color:#fecaca; }
  .col-amount { text-align:right; font-variant-numeric: tabular-nums; }
  .col-dates { text-align:right; }
  .col-user, .col-bm { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

  /* Таблица со скроллом по горизонтали для мобильных */
  .table-scroll { overflow-x: auto; border-radius: 12px; }
  .table-inner { min-width: 780px; }

  @media (max-width: 768px) {
    .header-content h1 { font-size: 20px; line-height: 1.2; }
    .header-actions { width: 100%; margin-top: 8px; }
    .filters { width: 100%; }
    .filters select { flex: 1 1 140px; }
    .apply { white-space: nowrap; }
  }
</style>

<div class="page-header">
  <div class="header-avatar"><i class="fas fa-history"></i></div>
  <div class="header-content">
    <h1>История заявок на вывод</h1>
    <p>Рефералы</p>
  </div>
  <div class="header-actions">
    <form class="filters" method="get">
      <select name="status">
        <option value="">Статус: Все</option>
        {% for val,label in status_choices %}
          <option value="{{ val }}" {% if status == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <select name="bookmaker">
        <option value="">Букмекер: Все</option>
        {% for val,label in bookmaker_choices %}
          <option value="{{ val }}" {% if bookmaker == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <button class="apply" type="submit">Применить</button>
    </form>
  </div>
  
</div>

<div class="table-scroll">
  <div class="table-inner">
    <div class="card" style="padding:12px; margin-bottom:8px;">
      <div class="row head">
        <div>ID</div>
        <div>Пользователь</div>
        <div>Букмекер / Аккаунт</div>
        <div class="col-amount">Сумма</div>
        <div>Статус</div>
        <div class="col-dates">Создано / Обработано</div>
      </div>
    </div>

    {% for it in items %}
      <div class="card" style="padding:12px; margin-bottom:10px;">
        <div class="row">
          <div>#{{ it.id }}</div>
          <div class="col-user">
            <div class="muted">{{ it.user_id }}</div>
            <div>@{{ it.username }}</div>
          </div>
          <div class="col-bm">
            <div>{{ it.bookmaker|upper }}</div>
            <div class="muted">{{ it.bookmaker_account_id }}</div>
          </div>
          <div class="col-amount">
            <strong>{{ it.amount }} {{ it.currency }}</strong>
          </div>
          <div>
            {% if it.status == 'completed' %}
              <span class="tag ok">Выплачено</span>
            {% elif it.status == 'processing' %}
              <span class="tag warn">В обработке</span>
            {% elif it.status == 'rejected' %}
              <span class="tag bad">Отклонено</span>
            {% else %}
              <span class="tag">Ожидает</span>
            {% endif %}
          </div>
          <div class="col-dates">
            <div>{{ it.created_at|date:"Y-m-d H:i" }}</div>
            <div class="muted">{{ it.processed_at|date:"Y-m-d H:i" }}</div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="card" style="padding:16px; text-align:center; color:#cccccc; background: transparent; border: none; box-shadow: none;">Нет заявок</div>
    {% endfor %}
  </div>
</div>

{% endblock %}
