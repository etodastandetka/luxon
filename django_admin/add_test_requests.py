#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü—É requests
"""

import os
import sys
import django
import sqlite3
from datetime import datetime, timedelta
import random

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ Django –ø—Ä–æ–µ–∫—Ç—É
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'admin_panel.settings')
django.setup()

def add_test_requests():
    """–î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É requests"""
    
    # –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Django
    db_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'admin.sqlite3')
    
    try:
        conn = sqlite3.connect(db_path)
        cursor = conn.cursor()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        cursor.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='requests'")
        if not cursor.fetchone():
            print("‚ùå –¢–∞–±–ª–∏—Ü–∞ requests –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!")
            return False
        
        # –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        cursor.execute("DELETE FROM requests WHERE user_id LIKE 'test_%'")
        
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏
        test_requests = [
            {
                'user_id': 123456789,
                'username': 'test_user_1',
                'first_name': '–¢–µ—Å—Ç',
                'last_name': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                'bookmaker': '1xBet',
                'account_id': '12345678',
                'amount': 1000.0,
                'request_type': 'deposit',
                'status': 'completed',
                'created_at': datetime.now() - timedelta(hours=2),
                'processed_at': datetime.now() - timedelta(hours=1)
            },
            {
                'user_id': 987654321,
                'username': 'test_user_2',
                'first_name': '–ê–Ω–Ω–∞',
                'last_name': '–°–º–∏—Ä–Ω–æ–≤–∞',
                'bookmaker': 'Melbet',
                'account_id': '87654321',
                'amount': 2500.0,
                'request_type': 'withdraw',
                'status': 'pending',
                'created_at': datetime.now() - timedelta(minutes=30)
            },
            {
                'user_id': 555666777,
                'username': 'test_user_3',
                'first_name': '–ò–≤–∞–Ω',
                'last_name': '–ü–µ—Ç—Ä–æ–≤',
                'bookmaker': 'Mostbet',
                'account_id': '55555555',
                'amount': 500.0,
                'request_type': 'deposit',
                'status': 'rejected',
                'created_at': datetime.now() - timedelta(hours=1),
                'processed_at': datetime.now() - timedelta(minutes=30)
            }
        ]
        
        for request in test_requests:
            cursor.execute('''
                INSERT INTO requests (
                    user_id, username, first_name, last_name, bookmaker, account_id,
                    amount, request_type, status, created_at, processed_at
                ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            ''', (
                request['user_id'],
                request['username'],
                request['first_name'],
                request['last_name'],
                request['bookmaker'],
                request['account_id'],
                request['amount'],
                request['request_type'],
                request['status'],
                request['created_at'],
                request.get('processed_at')
            ))
        
        conn.commit()
        print("‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫
        cursor.execute("SELECT COUNT(*) FROM requests")
        count = cursor.fetchone()[0]
        print(f"üìä –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫ –≤ –±–∞–∑–µ: {count}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏
        cursor.execute("""
            SELECT id, user_id, bookmaker, amount, request_type, status, created_at 
            FROM requests 
            ORDER BY created_at DESC 
            LIMIT 5
        """)
        
        print("\nüìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏:")
        for row in cursor.fetchall():
            print(f"  ID: {row[0]}, User: {row[1]}, {row[2]} - {row[3]} —Å–æ–º ({row[4]}) - {row[5]} - {row[6]}")
        
        conn.close()
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
        return False

if __name__ == "__main__":
    print("üîß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫...")
    
    if add_test_requests():
        print("üéâ –ì–æ—Ç–æ–≤–æ! –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã.")
    else:
        print("üí• –û—à–∏–±–∫–∞! –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏.")
