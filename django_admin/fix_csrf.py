#!/usr/bin/env python
import os
import sys
import django

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'admin_panel.settings')
django.setup()

from django.conf import settings
from django.core.management import execute_from_command_line

def fix_csrf_settings():
    """–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CSRF"""
    print("=== –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ CSRF ===")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    print(f"DEBUG: {settings.DEBUG}")
    print(f"ALLOWED_HOSTS: {settings.ALLOWED_HOSTS}")
    print(f"CSRF_TRUSTED_ORIGINS: {getattr(settings, 'CSRF_TRUSTED_ORIGINS', '–ù–ï –ù–ê–°–¢–†–û–ï–ù–û')}")
    
    # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    settings_content = '''
# –î–æ–±–∞–≤–ª—è–µ–º CSRF –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
CSRF_TRUSTED_ORIGINS = [
    'https://xendro.pro',
    'https://www.xendro.pro',
    'http://xendro.pro',
    'http://www.xendro.pro',
    'http://localhost:8081',
    'http://127.0.0.1:8081',
]

# –û—Ç–∫–ª—é—á–∞–µ–º CORS –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ (–º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å CSRF)
CORS_ALLOW_ALL_ORIGINS = False
CORS_ALLOW_CREDENTIALS = False

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Å—Å–∏–π –¥–ª—è CSRF
SESSION_COOKIE_SECURE = False  # –î–ª—è HTTP
SESSION_COOKIE_HTTPONLY = True
SESSION_COOKIE_AGE = 86400  # 24 —á–∞—Å–∞

# CSRF –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
CSRF_COOKIE_SECURE = False  # –î–ª—è HTTP
CSRF_COOKIE_HTTPONLY = True
CSRF_USE_SESSIONS = True
'''
    
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ñ–∞–π–ª
    with open('/var/www/luxon/django_admin/csrf_fix.py', 'w') as f:
        f.write(settings_content)
    
    print("‚úÖ –§–∞–π–ª csrf_fix.py —Å–æ–∑–¥–∞–Ω")
    print("üìã –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ settings.py:")
    print(settings_content)
    
    print("\nüîß –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:")
    print("1. –î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CSRF –≤ settings.py")
    print("2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Django")
    print("3. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞")

if __name__ == "__main__":
    fix_csrf_settings()
