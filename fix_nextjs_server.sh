#!/bin/bash

echo "üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò NEXT.JS –ù–ê –°–ï–†–í–ï–†–ï"
echo "========================================"

# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/luxon

# 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
echo "üì• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞..."
git pull origin main

# 3. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É Next.js
cd bot2/mini_app_site

# 4. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à Next.js
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞..."
rm -rf .next
rm -rf node_modules/.cache

# 5. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
npm install

# 6. –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
echo "üî® –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
npm run build

# 7. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pm2 stop luxon-nextjs 2>/dev/null || true
pm2 stop luxon-nextjs-client 2>/dev/null || true
pm2 delete luxon-nextjs 2>/dev/null || true
pm2 delete luxon-nextjs-client 2>/dev/null || true

# 8. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å
echo "üöÄ –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞..."
pm2 start npm --name "luxon-nextjs" --cwd /var/www/luxon/bot2/mini_app_site -- start

# 9. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
pm2 status

# 10. –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏:"
pm2 logs luxon-nextjs --lines 10

echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"
