# Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ€ÐµÑ„ÐµÑ€Ð°Ð»Ð¾Ð²

## ÐšÐ°Ðº Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ÑÑ

### 1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ° Ð² Telegram

1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð² Telegram
2. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ñ‚Ñ€Ð¸ Ñ‚Ð¾Ñ‡ÐºÐ¸ (Ð¼ÐµÐ½ÑŽ) Ð² Ð¿Ñ€Ð°Ð²Ð¾Ð¼ Ð²ÐµÑ€Ñ…Ð½ÐµÐ¼ ÑƒÐ³Ð»Ñƒ
3. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ "ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ" Ð¸Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð²ÐµÐ±-Ð²ÐµÑ€ÑÐ¸ÑŽ Telegram
4. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ DevTools (F12 Ð¸Ð»Ð¸ Ctrl+Shift+I)
5. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÑƒ "Console"

### 2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸

Ð˜Ñ‰Ð¸Ñ‚Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ:

#### âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð°Ñ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ:
```
=== DEBUG: Telegram WebApp Data ===
Telegram object exists: true
âœ… User ID from initDataUnsafe: [Ñ‡Ð¸ÑÐ»Ð¾]
ðŸ”„ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ€ÐµÑ„ÐµÑ€Ð°Ð»Ð¾Ð²: { userId, apiUrl, apiEndpoint }
ðŸ“¤ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº API: { url: "https://japar.click/api/public/referral-data?user_id=..." }
âœ… ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ response Ð¾Ñ‚ ...
ðŸ“‹ ÐžÑ‚Ð²ÐµÑ‚ API Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…: { data: {...}, success: true }
```

#### âŒ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹:

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 1: Telegram WebApp Ð½Ðµ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½**
```
âš ï¸ Telegram WebApp Ð½Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½
âŒ Not opened from Telegram bot, user ID not found
```
**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ñ‡ÐµÑ€ÐµÐ· Telegram Ð±Ð¾Ñ‚Ð°, Ð° Ð½Ðµ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ.

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 2: ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ‚Ð¸**
```
âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ€ÐµÑ„ÐµÑ€Ð°Ð»Ð¾Ð²: Failed to fetch
ðŸŒ Ð¡ÐµÑ‚ÐµÐ²Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð°
```
**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** 
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚-ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ ÑÐµÑ€Ð²ÐµÑ€ `https://japar.click` Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ CORS Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 3: ÐžÑˆÐ¸Ð±ÐºÐ° API**
```
âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ€ÐµÑ„ÐµÑ€Ð°Ð»Ð¾Ð²: HTTP 400/500
status: 400/500
```
**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** 
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ: `pm2 logs admin-nextjs | grep "Referral Data API"`
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ API endpoint Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚: `curl https://japar.click/api/public/referral-data?user_id=123456789`

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 4: Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚**
```
â±ï¸ Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (15000ms)
```
**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** 
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð°
- Ð£Ð²ÐµÐ»Ð¸Ñ‡ÑŒÑ‚Ðµ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚ Ð² ÐºÐ¾Ð´Ðµ (ÑÐµÐ¹Ñ‡Ð°Ñ 15 ÑÐµÐºÑƒÐ½Ð´)

### 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° API Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ

Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ:

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ API
curl "https://japar.click/api/public/referral-data?user_id=123456789"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²
pm2 logs admin-nextjs | grep "Referral Data API"
```

### 4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° CORS

Ð’ ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ CORS:
```
Access to fetch at 'https://japar.click/api/public/referral-data' from origin 'https://luxon.dad' has been blocked by CORS policy
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð² API endpoint ÐµÑÑ‚ÑŒ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº:
```typescript
response.headers.set('Access-Control-Allow-Origin', '*')
```

### 5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° user_id

Ð’ ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ:
```
âœ… User ID from initDataUnsafe: 123456789
```

Ð•ÑÐ»Ð¸ user_id Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½:
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾ Ñ‡ÐµÑ€ÐµÐ· Telegram Ð±Ð¾Ñ‚Ð°
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Telegram WebApp Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½ (Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸ `[Telegram.WebView]`)

### 6. Ð¢Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ

| ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° | ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð° | Ð ÐµÑˆÐµÐ½Ð¸Ðµ |
|----------|---------|---------|
| "Not opened from Telegram bot" | ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾ Ð½Ðµ Ñ‡ÐµÑ€ÐµÐ· Ð±Ð¾Ñ‚Ð° | ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· `/start` Ð² Ð±Ð¾Ñ‚Ðµ |
| "Failed to fetch" | ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° ÑÐµÑ‚Ð¸ Ð¸Ð»Ð¸ CORS | ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚ Ð¸ CORS Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ |
| "HTTP 400" | ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ user_id | ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ user_id (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ†Ð¸Ñ„Ñ€Ñ‹) |
| "HTTP 500" | ÐžÑˆÐ¸Ð±ÐºÐ° Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ | ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð° |
| "Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚" | ÐœÐµÐ´Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚ | Ð£Ð²ÐµÐ»Ð¸Ñ‡ÑŒÑ‚Ðµ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚ Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚ |

### 7. Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°:

```javascript
// ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Telegram WebApp
console.log('Telegram WebApp:', window.Telegram?.WebApp)
console.log('User ID:', window.Telegram?.WebApp?.initDataUnsafe?.user?.id)

// ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° API
fetch('https://japar.click/api/public/referral-data?user_id=YOUR_USER_ID')
  .then(r => r.json())
  .then(d => console.log('API Response:', d))
  .catch(e => console.error('API Error:', e))
```

Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ `YOUR_USER_ID` Ð½Ð° Ð²Ð°Ñˆ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Telegram user_id.

