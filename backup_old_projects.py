#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –ø–∞–ø–∫–∏ lux
"""

import os
import shutil
import tarfile
import datetime
import subprocess
import sys

def create_backup():
    """–°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤"""
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –¥–ª—è –∏–º–µ–Ω–∏ –±—ç–∫–∞–ø–∞
    timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_name = f"old_projects_backup_{timestamp}.tar.gz"
    
    print(f"üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–µ—Ä–≤–µ—Ä–∞...")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–∞–ø–∫–∞ lux
    lux_path = "/home/user/lux"  # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π –ø—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    if os.path.exists(lux_path):
        print(f"‚úÖ –ù–∞–π–¥–µ–Ω–∞ –ø–∞–ø–∫–∞: {lux_path}")
        
        # –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø
        print(f"üì¶ –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø: {backup_name}")
        
        try:
            with tarfile.open(backup_name, "w:gz") as tar:
                tar.add(lux_path, arcname="lux")
            print(f"‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: {backup_name}")
            
            # –ü–µ—Ä–µ–º–µ—â–∞–µ–º –±—ç–∫–∞–ø –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ
            backup_dest = f"/home/user/backups/{backup_name}"
            os.makedirs("/home/user/backups", exist_ok=True)
            shutil.move(backup_name, backup_dest)
            print(f"‚úÖ –ë—ç–∫–∞–ø –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤: {backup_dest}")
            
            return backup_dest
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—ç–∫–∞–ø–∞: {e}")
            return None
    else:
        print(f"‚ö†Ô∏è  –ü–∞–ø–∫–∞ {lux_path} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        return None

def remove_old_lux_folder():
    """–£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—É—é –ø–∞–ø–∫—É lux –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞"""
    
    lux_path = "/home/user/lux"
    
    if os.path.exists(lux_path):
        print(f"üóëÔ∏è  –£–¥–∞–ª—è–µ–º –ø–∞–ø–∫—É: {lux_path}")
        try:
            shutil.rmtree(lux_path)
            print(f"‚úÖ –ü–∞–ø–∫–∞ {lux_path} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞")
            return True
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–∞–ø–∫–∏: {e}")
            return False
    else:
        print(f"‚ö†Ô∏è  –ü–∞–ø–∫–∞ {lux_path} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        return True

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    
    print("üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –±—ç–∫–∞–ø–∞ –∏ –æ—á–∏—Å—Ç–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞...")
    
    # –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø
    backup_path = create_backup()
    
    if backup_path:
        print(f"‚úÖ –ë—ç–∫–∞–ø —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {backup_path}")
        
        # –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
        confirm = input("‚ùì –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –ø–∞–ø–∫—É lux? (y/N): ").lower().strip()
        
        if confirm in ['y', 'yes', '–¥–∞']:
            if remove_old_lux_folder():
                print("‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
                print(f"üì¶ –ë—ç–∫–∞–ø —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: {backup_path}")
            else:
                print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–∞–ø–∫–∏")
        else:
            print("‚è∏Ô∏è  –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ. –ë—ç–∫–∞–ø —Å–æ—Ö—Ä–∞–Ω–µ–Ω.")
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø. –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.")

if __name__ == "__main__":
    main()
