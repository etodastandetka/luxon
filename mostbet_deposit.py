#!/usr/bin/env python3
"""
–ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Mostbet Cash API
–ü—Ä–æ—Å—Ç–æ –≤–≤–æ–¥–∏—Ç–µ ID –∏–≥—Ä–æ–∫–∞ –∏ —Å—É–º–º—É - –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
"""

import hashlib
import hmac
import json
import requests
from datetime import datetime, timezone

class MostbetDeposit:
    def __init__(self):
        # –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è (–û–ë–ù–û–í–õ–ï–ù–ù–´–ï)
        self.api_key = "api-key:1b896249-f0dc-45ff-826e-4175c72d1e0e"
        self.secret = "a5cce17876708d9a3506b41ecf1f68dfc1658e9521d48c5a227340f24b99bfe8"
        self.cashpoint_id = "1343871"  # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π ID –∫–∞—Å—Å—ã
        self.base_url = "https://apimb.com"
    
    def get_timestamp(self):
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ UTC —Ñ–æ—Ä–º–∞—Ç–µ"""
        now = datetime.now(timezone.utc)
        return now.strftime("%Y-%m-%d %H:%M:%S")
    
    def generate_signature(self, path, request_body, timestamp):
        """–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å HMAC SHA3-256 –ø–æ–¥–ø–∏—Å—å"""
        signature_string = f"{self.api_key}{path}{request_body}{timestamp}"
        signature = hmac.new(
            self.secret.encode('utf-8'),
            signature_string.encode('utf-8'),
            hashlib.sha3_256
        ).hexdigest()
        return signature
    
    def deposit_player(self, player_id, amount, currency="KGS"):
        """–ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á–µ—Ç –∏–≥—Ä–æ–∫–∞"""
        try:
            path = f"/mbc/gateway/v1/api/cashpoint/{self.cashpoint_id}/player/deposit"
            timestamp = self.get_timestamp()
            
            # –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
            request_body = json.dumps({
                "brandId": 1,
                "playerId": str(player_id),
                "amount": float(amount),
                "currency": currency
            }, separators=(',', ':'))
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å—å
            signature = self.generate_signature(path, request_body, timestamp)
            
            # –ó–∞–≥–æ–ª–æ–≤–∫–∏
            headers = {
                'X-Api-Key': self.api_key,
                'X-Timestamp': timestamp,
                'X-Signature': signature,
                'X-Project': 'MBC',
                'Content-Type': 'application/json',
                'Accept': '*/*'
            }
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
            url = f"{self.base_url}{path}"
            response = requests.post(url, headers=headers, data=request_body, timeout=30)
            
            print(f"\nüîó URL: {url}")
            print(f"üìù –ó–∞–ø—Ä–æ—Å: {request_body}")
            print(f"‚è∞ –í—Ä–µ–º—è: {timestamp}")
            print(f"üîê –ü–æ–¥–ø–∏—Å—å: {signature[:20]}...")
            print(f"üìä –°—Ç–∞—Ç—É—Å: {response.status_code}")
            
            if response.status_code == 200:
                data = response.json()
                print(f"‚úÖ –£–°–ü–ï–•! –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:")
                print(f"   üÜî ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: {data.get('transactionId', 'N/A')}")
                print(f"   üìä –°—Ç–∞—Ç—É—Å: {data.get('status', 'N/A')}")
                return True
            else:
                print(f"‚ùå –û–®–ò–ë–ö–ê! {response.status_code}")
                try:
                    error_data = response.json()
                    print(f"   üìù –°–æ–æ–±—â–µ–Ω–∏–µ: {error_data.get('message', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}")
                    print(f"   üî¢ –ö–æ–¥: {error_data.get('code', 'N/A')}")
                except:
                    print(f"   üìù –û—Ç–≤–µ—Ç: {response.text}")
                return False
                
        except Exception as e:
            print(f"‚ùå –û–®–ò–ë–ö–ê: {e}")
            return False

def main():
    print("üé∞ MOSTBET CASH - –ü–û–ü–û–õ–ù–ï–ù–ò–ï –°–ß–ï–¢–ê")
    print("=" * 50)
    
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞
    mostbet = MostbetDeposit()
    
    while True:
        try:
            print(f"\nüìã –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:")
            
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º ID –∏–≥—Ä–æ–∫–∞
            player_id = input("üÜî ID –∏–≥—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, C92905): ").strip()
            if not player_id:
                print("‚ùå ID –∏–≥—Ä–æ–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!")
                continue
            
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—É–º–º—É
            amount_str = input("üí∞ –°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000): ").strip()
            if not amount_str:
                print("‚ùå –°—É–º–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π!")
                continue
            
            try:
                amount = float(amount_str)
                if amount <= 0:
                    print("‚ùå –°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0!")
                    continue
            except ValueError:
                print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—É–º–º—ã!")
                continue
            
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤–∞–ª—é—Ç—É
            currency = input("üí± –í–∞–ª—é—Ç–∞ (KGS/RUB/USD) [KGS]: ").strip().upper()
            if not currency:
                currency = "KGS"
            
            print(f"\nüîÑ –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ...")
            print(f"   üë§ –ò–≥—Ä–æ–∫: {player_id}")
            print(f"   üí∞ –°—É–º–º–∞: {amount} {currency}")
            
            # –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
            success = mostbet.deposit_player(player_id, amount, currency)
            
            if success:
                print(f"\nüéâ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!")
            else:
                print(f"\nüí• –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å!")
            
            # –°–ø—Ä–∞—à–∏–≤–∞–µ–º, —Ö–æ—Ç–∏—Ç–µ –ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            continue_choice = input(f"\nüîÑ –•–æ—Ç–∏—Ç–µ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –µ—â–µ –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞? (y/n): ").strip().lower()
            if continue_choice not in ['y', 'yes', '–¥–∞', '–¥']:
                break
                
        except KeyboardInterrupt:
            print(f"\n\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
            break
        except Exception as e:
            print(f"\n‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
            continue
    
    print(f"\nüéØ –°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Mostbet Cash API!")

if __name__ == "__main__":
    main()
