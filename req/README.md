# Читатель уведомлений о пополнениях (Кыргызстан)

Android приложение для автоматического чтения и парсинга уведомлений о пополнениях со всех кыргызских банковских приложений, включая клонированные.

## Возможности

- ✅ Автоматическое чтение всех уведомлений со всех приложений
- ✅ Поддержка клонированных приложений (Parallel Space, Multiple Accounts и др.)
- ✅ Парсинг пополнений из кыргызских банков:
  - РСК Банк
  - Демир Банк
  - Бай Тушум
  - Кыргызстан Банк (КИБ)
  - Optima Bank
  - И другие кыргызские банки (универсальный парсер)
- ✅ Поддержка нескольких валют: сом (KGS), доллар (USD), рубль (RUB), евро (EUR)
- ✅ Извлечение суммы, номера карты/счета из уведомлений
- ✅ Парсинг на русском и кыргызском языках
- ✅ Сохранение в локальную базу данных (Room)
- ✅ Отображение истории пополнений
- ✅ Подсчет общей суммы пополнений по валютам

## Установка и настройка

### 1. Сборка проекта

```bash
# Откройте проект в Android Studio
# Дождитесь синхронизации Gradle

# Или используйте Gradle через командную строку
./gradlew build
```

### 2. Настройка доступа к уведомлениям

После установки приложения:

1. Откройте приложение
2. Приложение автоматически предложит открыть настройки доступа к уведомлениям
3. Найдите "Читатель уведомлений" в списке
4. Включите переключатель доступа к уведомлениям
5. Вернитесь в приложение

**Путь:** Настройки → Приложения → Специальный доступ → Доступ к уведомлениям

Или напрямую через настройки Android: `Settings → Notification access`

## Как работает парсинг

Приложение использует систему парсеров для разных кыргызских банков:

1. **Определение банка** - по названию пакета приложения и тексту уведомления
2. **Извлечение суммы** - поиск паттернов типа "1000.00 сом", "1000,00 сомов", "1000 KGS" и т.д.
3. **Определение валюты** - автоматическое определение валюты (сом, доллар, рубль, евро)
4. **Извлечение номера карты** - последние 4 цифры из формата "****1234"
5. **Определение типа** - проверка что это именно пополнение (на русском и кыргызском языках)

## Поддерживаемые форматы уведомлений

Приложение распознает различные форматы сообщений на русском и кыргызском:

- "Поступило 1000.00 сом"
- "Пополнение карты *1234 на сумму 5000,00 сом"
- "Зачислено на счет: 10000.50 сом"
- "Толтолду 1000.00 сом" (кыргызский)
- "Толукталды 5000 сомов"
- "Кабыл алынды 2500.00 сом"
- И другие вариации

## Поддерживаемые банки

- **РСК Банк** - крупнейший банк Кыргызстана
- **Демир Банк** - популярный коммерческий банк
- **Бай Тушум** - банк с развитой сетью отделений
- **Кыргызстан Банк (КИБ)** - национальный банк
- **Optima Bank** - современный цифровой банк
- **Другие банки** - через универсальный парсер

## Структура проекта

```
app/src/main/java/com/req/notificationreader/
├── MainActivity.kt                 # Главный экран
├── NotificationReaderService.kt    # Сервис чтения уведомлений
├── adapter/
│   └── PaymentAdapter.kt           # Адаптер для списка
├── database/
│   ├── AppDatabase.kt              # База данных Room
│   └── PaymentDao.kt               # DAO для работы с БД
├── model/
│   └── PaymentNotification.kt     # Модель данных
└── parser/
    ├── BankParser.kt               # Интерфейс парсера
    ├── BaseBankParser.kt           # Базовый класс парсера
    ├── RskBankParser.kt            # Парсер РСК Банка
    ├── DemirBankParser.kt          # Парсер Демир Банка
    ├── BaiTushumParser.kt          # Парсер Бай Тушум
    ├── KyrgyzstanBankParser.kt     # Парсер Кыргызстан Банка
    ├── OptimaBankParser.kt         # Парсер Optima Bank
    ├── UniversalParser.kt          # Универсальный парсер
    └── ParserManager.kt            # Менеджер парсеров
```

## Технологии

- Kotlin
- Android SDK
- Room Database
- Coroutines & Flow
- Material Design Components
- NotificationListenerService API

## Важные замечания

⚠️ **Безопасность:** Приложение работает локально, все данные хранятся только на устройстве.

⚠️ **Разрешения:** Приложению требуется разрешение на чтение уведомлений для работы.

⚠️ **Клонированные приложения:** Приложение автоматически определяет клонированные приложения по паттерну `.clone` в названии пакета.

⚠️ **Валюта:** По умолчанию определяется сом (KGS), но поддерживаются также доллары, рубли и евро.

## Добавление поддержки новых банков

Чтобы добавить поддержку нового кыргызского банка, создайте новый парсер:

```kotlin
class NewBankParser : BaseBankParser() {
    override fun canParse(packageName: String, text: String): Boolean {
        // Проверка, является ли это уведомлением этого банка
        return packageName.contains("newbank") || 
               text.contains("новый банк", ignoreCase = true)
    }
    
    override fun parse(packageName: String, text: String): PaymentNotification? {
        if (!isTopUpNotification(text)) {
            return null
        }
        
        val amount = extractAmount(text) ?: return null
        val currency = extractCurrency(text) // Автоматически определит валюту
        val cardNumber = extractCardNumber(text)
        val accountNumber = extractAccountNumber(text)
        
        return PaymentNotification(
            bankName = "Новый Банк",
            packageName = packageName,
            amount = amount,
            currency = currency,
            cardNumber = cardNumber,
            accountNumber = accountNumber,
            rawText = text
        )
    }
    
    private fun isTopUpNotification(text: String): Boolean {
        val topUpKeywords = listOf(
            "пополнен", "поступило", "зачислен", "получен",
            "толтолду", "толукталды", "кабыл алынды" // Кыргызский
        )
        return topUpKeywords.any { text.contains(it, ignoreCase = true) }
    }
    
    override fun getBankName(packageName: String): String = "Новый Банк"
}
```

И добавьте его в `ParserManager` перед `UniversalParser`.

## Лицензия

Этот проект создан для личного использования.
