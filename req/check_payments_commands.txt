# Команды для проверки входящих платежей в базе данных
# База: postgresql://gen_user:dastan10dz@89.23.117.61:5432/default_db

# 1. Подключиться к базе данных
psql -h 89.23.117.61 -U gen_user -d default_db
# Пароль: dastan10dz

# 2. Посмотреть последние 10 платежей
SELECT 
    id,
    amount,
    bank,
    payment_date,
    LEFT(notification_text, 100) as text_preview,
    request_id,
    is_processed,
    created_at
FROM incoming_payments
ORDER BY created_at DESC
LIMIT 10;

# 3. Посчитать количество платежей за сегодня
SELECT COUNT(*) as total_today
FROM incoming_payments
WHERE DATE(created_at) = CURRENT_DATE;

# 4. Показать платежи за последний час
SELECT 
    id,
    amount,
    bank,
    payment_date,
    created_at
FROM incoming_payments
WHERE created_at >= NOW() - INTERVAL '1 hour'
ORDER BY created_at DESC;

# 5. Подсчитать платежи по банкам
SELECT 
    bank,
    COUNT(*) as count,
    SUM(amount) as total_amount
FROM incoming_payments
GROUP BY bank
ORDER BY count DESC;

# 6. Показать необработанные платежи
SELECT 
    id,
    amount,
    bank,
    payment_date,
    created_at
FROM incoming_payments
WHERE is_processed = false
ORDER BY created_at DESC
LIMIT 20;

# 7. Показать платежи, привязанные к заявкам
SELECT 
    ip.id,
    ip.amount,
    ip.bank,
    ip.request_id,
    r.status as request_status,
    r.user_id,
    ip.created_at
FROM incoming_payments ip
LEFT JOIN requests r ON ip.request_id = r.id
WHERE ip.request_id IS NOT NULL
ORDER BY ip.created_at DESC
LIMIT 20;

